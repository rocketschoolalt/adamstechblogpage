import { base64 } from "./deps.ts";
import { BODY_TYPES, isAsyncIterable, isReader } from "./util.ts";
function isFileInfo(value) {
    return Boolean(value && typeof value === "object" && "mtime" in value && "size" in value);
}
function calcStatTag(entity) {
    const mtime = entity.mtime?.getTime().toString(16) ?? "0";
    const size = entity.size.toString(16);
    return `"${size}-${mtime}"`;
}
const encoder = new TextEncoder();
async function calcEntityTag(entity) {
    if (entity.length === 0) {
        return `"0-2jmj7l5rSw0yVb/vlWAYkK/YBwk="`;
    }
    if (typeof entity === "string") {
        entity = encoder.encode(entity);
    }
    const hash = base64.encode(await crypto.subtle.digest("SHA-1", entity)).substring(0, 27);
    return `"${entity.length.toString(16)}-${hash}"`;
}
function fstat(file) {
    if ("fstat" in Deno) {
        // deno-lint-ignore no-explicit-any
        return Deno.fstat(file.rid);
    }
    return Promise.resolve(undefined);
}
/** For a given Context, try to determine the response body entity that an ETag
 * can be calculated from. */ // deno-lint-ignore no-explicit-any
export function getEntity(context) {
    const { body  } = context.response;
    if (body instanceof Deno.File) {
        return fstat(body);
    }
    if (body instanceof Uint8Array) {
        return Promise.resolve(body);
    }
    if (BODY_TYPES.includes(typeof body)) {
        return Promise.resolve(String(body));
    }
    if (isAsyncIterable(body) || isReader(body)) {
        return Promise.resolve(undefined);
    }
    if (typeof body === "object" && body !== null) {
        try {
            const bodyText = JSON.stringify(body);
            return Promise.resolve(bodyText);
        } catch  {
        // We don't really care about errors here
        }
    }
    return Promise.resolve(undefined);
}
/**
 * Calculate an ETag value for an entity. If the entity is `FileInfo`, then the
 * tag will default to a _weak_ ETag.  `options.weak` overrides any default
 * behavior in generating the tag.
 *
 * @param entity A string, Uint8Array, or file info to use to generate the ETag
 * @param options
 */ export async function calculate(entity, options = {
}) {
    const weak = options.weak ?? isFileInfo(entity);
    const tag = isFileInfo(entity) ? calcStatTag(entity) : await calcEntityTag(entity);
    return weak ? `W/${tag}` : tag;
}
/**
 * Create middleware that will attempt to decode the response.body into
 * something that can be used to generate an `ETag` and add the `ETag` header to
 * the response.
 */ // deno-lint-ignore no-explicit-any
export function factory(options) {
    return async function etag(context, next) {
        await next();
        if (!context.response.headers.has("ETag")) {
            const entity = await getEntity(context);
            if (entity) {
                context.response.headers.set("ETag", await calculate(entity, options));
            }
        }
    };
}
/**
 * A helper function that takes the value from the `If-Match` header and an
 * entity and returns `true` if the `ETag` for the entity matches the supplied
 * value, otherwise `false`.
 *
 * See MDN's [`If-Match`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/If-Match)
 * article for more information on how to use this function.
 */ export async function ifMatch(value, entity, options = {
}) {
    const etag = await calculate(entity, options);
    // Weak tags cannot be matched and return false.
    if (etag.startsWith("W/")) {
        return false;
    }
    if (value.trim() === "*") {
        return true;
    }
    const tags = value.split(/\s*,\s*/);
    return tags.includes(etag);
}
/**
 * A helper function that takes the value from the `If-No-Match` header and
 * an entity and returns `false` if the `ETag` for the entity matches the
 * supplied value, otherwise `false`.
 *
 * See MDN's [`If-None-Match`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/If-None-Match)
 * article for more information on how to use this function.
 */ export async function ifNoneMatch(value, entity, options = {
}) {
    if (value.trim() === "*") {
        return false;
    }
    const etag = await calculate(entity, options);
    const tags = value.split(/\s*,\s*/);
    return !tags.includes(etag);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImh0dHBzOi8vZGVuby5sYW5kL3gvb2FrQHYxMC4xLjAvZXRhZy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxOC0yMDIxIHRoZSBvYWsgYXV0aG9ycy4gQWxsIHJpZ2h0cyByZXNlcnZlZC4gTUlUIGxpY2Vuc2UuXG5cbmltcG9ydCB0eXBlIHsgU3RhdGUgfSBmcm9tIFwiLi9hcHBsaWNhdGlvbi50c1wiO1xuaW1wb3J0IHR5cGUgeyBDb250ZXh0IH0gZnJvbSBcIi4vY29udGV4dC50c1wiO1xuaW1wb3J0IHsgYmFzZTY0IH0gZnJvbSBcIi4vZGVwcy50c1wiO1xuaW1wb3J0IHR5cGUgeyBNaWRkbGV3YXJlIH0gZnJvbSBcIi4vbWlkZGxld2FyZS50c1wiO1xuaW1wb3J0IHsgQk9EWV9UWVBFUywgaXNBc3luY0l0ZXJhYmxlLCBpc1JlYWRlciB9IGZyb20gXCIuL3V0aWwudHNcIjtcblxuZXhwb3J0IGludGVyZmFjZSBFVGFnT3B0aW9ucyB7XG4gIC8qKiBPdmVycmlkZSB0aGUgZGVmYXVsdCBiZWhhdmlvciBvZiBjYWxjdWxhdGluZyB0aGUgYEVUYWdgLCBlaXRoZXIgZm9yY2luZ1xuICAgKiBhIHRhZyB0byBiZSBsYWJlbGxlZCB3ZWFrIG9yIG5vdC4gKi9cbiAgd2Vhaz86IGJvb2xlYW47XG59XG5cbi8qKlxuICogSnVzdCB0aGUgcGFydCBvZiBgRGVuby5GaWxlSW5mb2AgdGhhdCBpcyByZXF1aXJlZCB0byBjYWxjdWxhdGUgYW4gYEVUYWdgLFxuICogc28gcGFydGlhbCBvciB1c2VyIGdlbmVyYXRlZCBmaWxlIGluZm9ybWF0aW9uIGNhbiBiZSBwYXNzZWQuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgRmlsZUluZm8ge1xuICBtdGltZTogRGF0ZSB8IG51bGw7XG4gIHNpemU6IG51bWJlcjtcbn1cblxuZnVuY3Rpb24gaXNGaWxlSW5mbyh2YWx1ZTogdW5rbm93bik6IHZhbHVlIGlzIEZpbGVJbmZvIHtcbiAgcmV0dXJuIEJvb2xlYW4oXG4gICAgdmFsdWUgJiYgdHlwZW9mIHZhbHVlID09PSBcIm9iamVjdFwiICYmIFwibXRpbWVcIiBpbiB2YWx1ZSAmJiBcInNpemVcIiBpbiB2YWx1ZSxcbiAgKTtcbn1cblxuZnVuY3Rpb24gY2FsY1N0YXRUYWcoZW50aXR5OiBGaWxlSW5mbyk6IHN0cmluZyB7XG4gIGNvbnN0IG10aW1lID0gZW50aXR5Lm10aW1lPy5nZXRUaW1lKCkudG9TdHJpbmcoMTYpID8/IFwiMFwiO1xuICBjb25zdCBzaXplID0gZW50aXR5LnNpemUudG9TdHJpbmcoMTYpO1xuXG4gIHJldHVybiBgXCIke3NpemV9LSR7bXRpbWV9XCJgO1xufVxuXG5jb25zdCBlbmNvZGVyID0gbmV3IFRleHRFbmNvZGVyKCk7XG5cbmFzeW5jIGZ1bmN0aW9uIGNhbGNFbnRpdHlUYWcoZW50aXR5OiBzdHJpbmcgfCBVaW50OEFycmF5KTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgaWYgKGVudGl0eS5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4gYFwiMC0yam1qN2w1clN3MHlWYi92bFdBWWtLL1lCd2s9XCJgO1xuICB9XG5cbiAgaWYgKHR5cGVvZiBlbnRpdHkgPT09IFwic3RyaW5nXCIpIHtcbiAgICBlbnRpdHkgPSBlbmNvZGVyLmVuY29kZShlbnRpdHkpO1xuICB9XG5cbiAgY29uc3QgaGFzaCA9IGJhc2U2NC5lbmNvZGUoYXdhaXQgY3J5cHRvLnN1YnRsZS5kaWdlc3QoXCJTSEEtMVwiLCBlbnRpdHkpKVxuICAgIC5zdWJzdHJpbmcoMCwgMjcpO1xuXG4gIHJldHVybiBgXCIke2VudGl0eS5sZW5ndGgudG9TdHJpbmcoMTYpfS0ke2hhc2h9XCJgO1xufVxuXG5mdW5jdGlvbiBmc3RhdChmaWxlOiBEZW5vLkZpbGUpOiBQcm9taXNlPERlbm8uRmlsZUluZm8gfCB1bmRlZmluZWQ+IHtcbiAgaWYgKFwiZnN0YXRcIiBpbiBEZW5vKSB7XG4gICAgLy8gZGVuby1saW50LWlnbm9yZSBuby1leHBsaWNpdC1hbnlcbiAgICByZXR1cm4gKERlbm8gYXMgYW55KS5mc3RhdChmaWxlLnJpZCk7XG4gIH1cbiAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh1bmRlZmluZWQpO1xufVxuXG4vKiogRm9yIGEgZ2l2ZW4gQ29udGV4dCwgdHJ5IHRvIGRldGVybWluZSB0aGUgcmVzcG9uc2UgYm9keSBlbnRpdHkgdGhhdCBhbiBFVGFnXG4gKiBjYW4gYmUgY2FsY3VsYXRlZCBmcm9tLiAqL1xuLy8gZGVuby1saW50LWlnbm9yZSBuby1leHBsaWNpdC1hbnlcbmV4cG9ydCBmdW5jdGlvbiBnZXRFbnRpdHk8UyBleHRlbmRzIFN0YXRlID0gUmVjb3JkPHN0cmluZywgYW55Pj4oXG4gIGNvbnRleHQ6IENvbnRleHQ8Uz4sXG4pOiBQcm9taXNlPHN0cmluZyB8IFVpbnQ4QXJyYXkgfCBEZW5vLkZpbGVJbmZvIHwgdW5kZWZpbmVkPiB7XG4gIGNvbnN0IHsgYm9keSB9ID0gY29udGV4dC5yZXNwb25zZTtcbiAgaWYgKGJvZHkgaW5zdGFuY2VvZiBEZW5vLkZpbGUpIHtcbiAgICByZXR1cm4gZnN0YXQoYm9keSk7XG4gIH1cbiAgaWYgKGJvZHkgaW5zdGFuY2VvZiBVaW50OEFycmF5KSB7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShib2R5KTtcbiAgfVxuICBpZiAoQk9EWV9UWVBFUy5pbmNsdWRlcyh0eXBlb2YgYm9keSkpIHtcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKFN0cmluZyhib2R5KSk7XG4gIH1cbiAgaWYgKGlzQXN5bmNJdGVyYWJsZShib2R5KSB8fCBpc1JlYWRlcihib2R5KSkge1xuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodW5kZWZpbmVkKTtcbiAgfVxuICBpZiAodHlwZW9mIGJvZHkgPT09IFwib2JqZWN0XCIgJiYgYm9keSAhPT0gbnVsbCkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBib2R5VGV4dCA9IEpTT04uc3RyaW5naWZ5KGJvZHkpO1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShib2R5VGV4dCk7XG4gICAgfSBjYXRjaCB7XG4gICAgICAvLyBXZSBkb24ndCByZWFsbHkgY2FyZSBhYm91dCBlcnJvcnMgaGVyZVxuICAgIH1cbiAgfVxuICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHVuZGVmaW5lZCk7XG59XG5cbi8qKlxuICogQ2FsY3VsYXRlIGFuIEVUYWcgdmFsdWUgZm9yIGFuIGVudGl0eS4gSWYgdGhlIGVudGl0eSBpcyBgRmlsZUluZm9gLCB0aGVuIHRoZVxuICogdGFnIHdpbGwgZGVmYXVsdCB0byBhIF93ZWFrXyBFVGFnLiAgYG9wdGlvbnMud2Vha2Agb3ZlcnJpZGVzIGFueSBkZWZhdWx0XG4gKiBiZWhhdmlvciBpbiBnZW5lcmF0aW5nIHRoZSB0YWcuXG4gKlxuICogQHBhcmFtIGVudGl0eSBBIHN0cmluZywgVWludDhBcnJheSwgb3IgZmlsZSBpbmZvIHRvIHVzZSB0byBnZW5lcmF0ZSB0aGUgRVRhZ1xuICogQHBhcmFtIG9wdGlvbnNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNhbGN1bGF0ZShcbiAgZW50aXR5OiBzdHJpbmcgfCBVaW50OEFycmF5IHwgRmlsZUluZm8sXG4gIG9wdGlvbnM6IEVUYWdPcHRpb25zID0ge30sXG4pOiBQcm9taXNlPHN0cmluZz4ge1xuICBjb25zdCB3ZWFrID0gb3B0aW9ucy53ZWFrID8/IGlzRmlsZUluZm8oZW50aXR5KTtcbiAgY29uc3QgdGFnID0gaXNGaWxlSW5mbyhlbnRpdHkpXG4gICAgPyBjYWxjU3RhdFRhZyhlbnRpdHkpXG4gICAgOiBhd2FpdCBjYWxjRW50aXR5VGFnKGVudGl0eSk7XG5cbiAgcmV0dXJuIHdlYWsgPyBgVy8ke3RhZ31gIDogdGFnO1xufVxuXG4vKipcbiAqIENyZWF0ZSBtaWRkbGV3YXJlIHRoYXQgd2lsbCBhdHRlbXB0IHRvIGRlY29kZSB0aGUgcmVzcG9uc2UuYm9keSBpbnRvXG4gKiBzb21ldGhpbmcgdGhhdCBjYW4gYmUgdXNlZCB0byBnZW5lcmF0ZSBhbiBgRVRhZ2AgYW5kIGFkZCB0aGUgYEVUYWdgIGhlYWRlciB0b1xuICogdGhlIHJlc3BvbnNlLlxuICovXG4vLyBkZW5vLWxpbnQtaWdub3JlIG5vLWV4cGxpY2l0LWFueVxuZXhwb3J0IGZ1bmN0aW9uIGZhY3Rvcnk8UyBleHRlbmRzIFN0YXRlID0gUmVjb3JkPHN0cmluZywgYW55Pj4oXG4gIG9wdGlvbnM/OiBFVGFnT3B0aW9ucyxcbik6IE1pZGRsZXdhcmU8Uz4ge1xuICByZXR1cm4gYXN5bmMgZnVuY3Rpb24gZXRhZyhjb250ZXh0OiBDb250ZXh0PFM+LCBuZXh0KSB7XG4gICAgYXdhaXQgbmV4dCgpO1xuICAgIGlmICghY29udGV4dC5yZXNwb25zZS5oZWFkZXJzLmhhcyhcIkVUYWdcIikpIHtcbiAgICAgIGNvbnN0IGVudGl0eSA9IGF3YWl0IGdldEVudGl0eShjb250ZXh0KTtcbiAgICAgIGlmIChlbnRpdHkpIHtcbiAgICAgICAgY29udGV4dC5yZXNwb25zZS5oZWFkZXJzLnNldChcIkVUYWdcIiwgYXdhaXQgY2FsY3VsYXRlKGVudGl0eSwgb3B0aW9ucykpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbn1cblxuLyoqXG4gKiBBIGhlbHBlciBmdW5jdGlvbiB0aGF0IHRha2VzIHRoZSB2YWx1ZSBmcm9tIHRoZSBgSWYtTWF0Y2hgIGhlYWRlciBhbmQgYW5cbiAqIGVudGl0eSBhbmQgcmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGBFVGFnYCBmb3IgdGhlIGVudGl0eSBtYXRjaGVzIHRoZSBzdXBwbGllZFxuICogdmFsdWUsIG90aGVyd2lzZSBgZmFsc2VgLlxuICpcbiAqIFNlZSBNRE4ncyBbYElmLU1hdGNoYF0oaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSFRUUC9IZWFkZXJzL0lmLU1hdGNoKVxuICogYXJ0aWNsZSBmb3IgbW9yZSBpbmZvcm1hdGlvbiBvbiBob3cgdG8gdXNlIHRoaXMgZnVuY3Rpb24uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBpZk1hdGNoKFxuICB2YWx1ZTogc3RyaW5nLFxuICBlbnRpdHk6IHN0cmluZyB8IFVpbnQ4QXJyYXkgfCBGaWxlSW5mbyxcbiAgb3B0aW9uczogRVRhZ09wdGlvbnMgPSB7fSxcbik6IFByb21pc2U8Ym9vbGVhbj4ge1xuICBjb25zdCBldGFnID0gYXdhaXQgY2FsY3VsYXRlKGVudGl0eSwgb3B0aW9ucyk7XG4gIC8vIFdlYWsgdGFncyBjYW5ub3QgYmUgbWF0Y2hlZCBhbmQgcmV0dXJuIGZhbHNlLlxuICBpZiAoZXRhZy5zdGFydHNXaXRoKFwiVy9cIikpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgaWYgKHZhbHVlLnRyaW0oKSA9PT0gXCIqXCIpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBjb25zdCB0YWdzID0gdmFsdWUuc3BsaXQoL1xccyosXFxzKi8pO1xuICByZXR1cm4gdGFncy5pbmNsdWRlcyhldGFnKTtcbn1cblxuLyoqXG4gKiBBIGhlbHBlciBmdW5jdGlvbiB0aGF0IHRha2VzIHRoZSB2YWx1ZSBmcm9tIHRoZSBgSWYtTm8tTWF0Y2hgIGhlYWRlciBhbmRcbiAqIGFuIGVudGl0eSBhbmQgcmV0dXJucyBgZmFsc2VgIGlmIHRoZSBgRVRhZ2AgZm9yIHRoZSBlbnRpdHkgbWF0Y2hlcyB0aGVcbiAqIHN1cHBsaWVkIHZhbHVlLCBvdGhlcndpc2UgYGZhbHNlYC5cbiAqXG4gKiBTZWUgTUROJ3MgW2BJZi1Ob25lLU1hdGNoYF0oaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSFRUUC9IZWFkZXJzL0lmLU5vbmUtTWF0Y2gpXG4gKiBhcnRpY2xlIGZvciBtb3JlIGluZm9ybWF0aW9uIG9uIGhvdyB0byB1c2UgdGhpcyBmdW5jdGlvbi5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGlmTm9uZU1hdGNoKFxuICB2YWx1ZTogc3RyaW5nLFxuICBlbnRpdHk6IHN0cmluZyB8IFVpbnQ4QXJyYXkgfCBGaWxlSW5mbyxcbiAgb3B0aW9uczogRVRhZ09wdGlvbnMgPSB7fSxcbik6IFByb21pc2U8Ym9vbGVhbj4ge1xuICBpZiAodmFsdWUudHJpbSgpID09PSBcIipcIikge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBjb25zdCBldGFnID0gYXdhaXQgY2FsY3VsYXRlKGVudGl0eSwgb3B0aW9ucyk7XG4gIGNvbnN0IHRhZ3MgPSB2YWx1ZS5zcGxpdCgvXFxzKixcXHMqLyk7XG4gIHJldHVybiAhdGFncy5pbmNsdWRlcyhldGFnKTtcbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFJQSxNQUFNLEdBQUcsTUFBTSxRQUFRLENBQVc7QUFFbEMsTUFBTSxHQUFHLFVBQVUsRUFBRSxlQUFlLEVBQUUsUUFBUSxRQUFRLENBQVc7U0FpQnhELFVBQVUsQ0FBQyxLQUFjLEVBQXFCLENBQUM7SUFDdEQsTUFBTSxDQUFDLE9BQU8sQ0FDWixLQUFLLElBQUksTUFBTSxDQUFDLEtBQUssS0FBSyxDQUFRLFdBQUksQ0FBTyxVQUFJLEtBQUssSUFBSSxDQUFNLFNBQUksS0FBSztBQUU3RSxDQUFDO1NBRVEsV0FBVyxDQUFDLE1BQWdCLEVBQVUsQ0FBQztJQUM5QyxLQUFLLENBQUMsS0FBSyxHQUFHLE1BQU0sQ0FBQyxLQUFLLEVBQUUsT0FBTyxHQUFHLFFBQVEsQ0FBQyxFQUFFLEtBQUssQ0FBRztJQUN6RCxLQUFLLENBQUMsSUFBSSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUU7SUFFcEMsTUFBTSxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBQzVCLENBQUM7QUFFRCxLQUFLLENBQUMsT0FBTyxHQUFHLEdBQUcsQ0FBQyxXQUFXO2VBRWhCLGFBQWEsQ0FBQyxNQUEyQixFQUFtQixDQUFDO0lBQzFFLEVBQUUsRUFBRSxNQUFNLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRSxDQUFDO1FBQ3hCLE1BQU0sRUFBRSxnQ0FBZ0M7SUFDMUMsQ0FBQztJQUVELEVBQUUsRUFBRSxNQUFNLENBQUMsTUFBTSxLQUFLLENBQVEsU0FBRSxDQUFD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