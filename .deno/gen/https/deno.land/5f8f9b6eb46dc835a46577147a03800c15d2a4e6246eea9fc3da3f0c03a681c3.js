const matchCache = {
};
// deno-lint-ignore no-control-regex
const FIELD_CONTENT_REGEXP = /^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;
const KEY_REGEXP = /(?:^|;) *([^=]*)=[^;]*/g;
const SAME_SITE_REGEXP = /^(?:lax|none|strict)$/i;
function getPattern(name) {
    if (name in matchCache) {
        return matchCache[name];
    }
    return matchCache[name] = new RegExp(`(?:^|;) *${name.replace(/[-[\]{}()*+?.,\\^$|#\s]/g, "\\$&")}=([^;]*)`);
}
function pushCookie(headers, cookie) {
    if (cookie.overwrite) {
        for(let i = headers.length - 1; i >= 0; i--){
            if (headers[i].indexOf(`${cookie.name}=`) === 0) {
                headers.splice(i, 1);
            }
        }
    }
    headers.push(cookie.toHeader());
}
function validateCookieProperty(key, value) {
    if (value && !FIELD_CONTENT_REGEXP.test(value)) {
        throw new TypeError(`The ${key} of the cookie (${value}) is invalid.`);
    }
}
class Cookie {
    domain;
    expires;
    httpOnly = true;
    maxAge;
    name;
    overwrite = false;
    path = "/";
    sameSite = false;
    secure = false;
    signed;
    value;
    /** A logical representation of a cookie, used to internally manage the
   * cookie instances. */ constructor(name, value, attributes){
        validateCookieProperty("name", name);
        validateCookieProperty("value", value);
        this.name = name;
        this.value = value ?? "";
        Object.assign(this, attributes);
        if (!this.value) {
            this.expires = new Date(0);
            this.maxAge = undefined;
        }
        validateCookieProperty("path", this.path);
        validateCookieProperty("domain", this.domain);
        if (this.sameSite && typeof this.sameSite === "string" && !SAME_SITE_REGEXP.test(this.sameSite)) {
            throw new TypeError(`The sameSite of the cookie ("${this.sameSite}") is invalid.`);
        }
    }
    toHeader() {
        let header = this.toString();
        if (this.maxAge) {
            this.expires = new Date(Date.now() + this.maxAge * 1000);
        }
        if (this.path) {
            header += `; path=${this.path}`;
        }
        if (this.expires) {
            header += `; expires=${this.expires.toUTCString()}`;
        }
        if (this.domain) {
            header += `; domain=${this.domain}`;
        }
        if (this.sameSite) {
            header += `; samesite=${this.sameSite === true ? "strict" : this.sameSite.toLowerCase()}`;
        }
        if (this.secure) {
            header += "; secure";
        }
        if (this.httpOnly) {
            header += "; httponly";
        }
        return header;
    }
    toString() {
        return `${this.name}=${this.value}`;
    }
}
/** An interface which allows setting and accessing cookies related to both the
 * current request and response. */ export class Cookies {
    #cookieKeys;
    #keys;
    #request;
    #response;
    #secure;
     #requestKeys() {
        if (this.#cookieKeys) {
            return this.#cookieKeys;
        }
        const result = this.#cookieKeys = [];
        const header = this.#request.headers.get("cookie");
        if (!header) {
            return result;
        }
        let matches;
        while(matches = KEY_REGEXP.exec(header)){
            const [, key] = matches;
            result.push(key);
        }
        return result;
    }
    constructor(request, response, options = {
    }){
        const { keys , secure  } = options;
        this.#keys = keys;
        this.#request = request;
        this.#response = response;
        this.#secure = secure;
    }
    /** Set a cookie to be deleted in the response.  This is a "shortcut" to
   * `.set(name, null, options?)`. */ delete(name, options = {
    }) {
        this.set(name, null, options);
        return true;
    }
    /** Iterate over the request's cookies, yielding up a tuple containing the
   * key and the value.
   *
   * If there are keys set on the application, only keys and values that are
   * properly signed will be returned. */ async *entries() {
        const keys = this.#requestKeys();
        for (const key of keys){
            const value = await this.get(key);
            if (value) {
                yield [
                    key,
                    value
                ];
            }
        }
    }
    async forEach(callback, // deno-lint-ignore no-explicit-any
    thisArg = null) {
        const keys = this.#requestKeys();
        for (const key of keys){
            const value = await this.get(key);
            if (value) {
                callback.call(thisArg, key, value, this);
            }
        }
    }
    /** Get the value of a cookie from the request.
   *
   * If the cookie is signed, and the signature is invalid, the cookie will
   * be set to be deleted in the the response.  If the signature uses an "old"
   * key, the cookie will be re-signed with the current key and be added to the
   * response to be updated. */ async get(name, options = {
    }) {
        const signed = options.signed ?? !!this.#keys;
        const nameSig = `${name}.sig`;
        const header = this.#request.headers.get("cookie");
        if (!header) {
            return;
        }
        const match = header.match(getPattern(name));
        if (!match) {
            return;
        }
        const [, value] = match;
        if (!signed) {
            return value;
        }
        const digest = await this.get(nameSig, {
            signed: false
        });
        if (!digest) {
            return;
        }
        const data = `${name}=${value}`;
        if (!this.#keys) {
            throw new TypeError("keys required for signed cookies");
        }
        const index = await this.#keys.indexOf(data, digest);
        if (index < 0) {
            this.delete(nameSig, {
                path: "/",
                signed: false
            });
        } else {
            if (index) {
                // the key has "aged" and needs to be re-signed
                this.set(nameSig, await this.#keys.sign(data), {
                    signed: false
                });
            }
            return value;
        }
    }
    /** Iterate over the request's cookies, yielding up the keys.
   *
   * If there are keys set on the application, only the keys that are properly
   * signed will be returned. */ async *keys() {
        const keys = this.#requestKeys();
        for (const key of keys){
            const value = await this.get(key);
            if (value) {
                yield key;
            }
        }
    }
    /** Set a cookie in the response.
   *
   * If there are keys set in the application, cookies will be automatically
   * signed, unless overridden by the set options.  Cookies can be deleted by
   * setting the value to `null`. */ async set(name, value, options = {
    }) {
        const request = this.#request;
        const response = this.#response;
        const headers = [];
        for (const [key, value1] of response.headers.entries()){
            if (key === "set-cookie") {
                headers.push(value1);
            }
        }
        const secure = this.#secure !== undefined ? this.#secure : request.secure;
        const signed = options.signed ?? !!this.#keys;
        if (!secure && options.secure && !options.ignoreInsecure) {
            throw new TypeError("Cannot send secure cookie over unencrypted connection.");
        }
        const cookie = new Cookie(name, value, options);
        cookie.secure = options.secure ?? secure;
        pushCookie(headers, cookie);
        if (signed) {
            if (!this.#keys) {
                throw new TypeError(".keys required for signed cookies.");
            }
            cookie.value = await this.#keys.sign(cookie.toString());
            cookie.name += ".sig";
            pushCookie(headers, cookie);
        }
        response.headers.delete("Set-Cookie");
        for (const header of headers){
            response.headers.append("Set-Cookie", header);
        }
        return this;
    }
    /** Iterate over the request's cookies, yielding up each value.
   *
   * If there are keys set on the application, only the values that are
   * properly signed will be returned. */ async *values() {
        const keys = this.#requestKeys();
        for (const key of keys){
            const value = await this.get(key);
            if (value) {
                yield value;
            }
        }
    }
    /** Iterate over the request's cookies, yielding up a tuple containing the
   * key and the value.
   *
   * If there are keys set on the application, only keys and values that are
   * properly signed will be returned. */ async *[Symbol.asyncIterator]() {
        const keys = this.#requestKeys();
        for (const key of keys){
            const value = await this.get(key);
            if (value) {
                yield [
                    key,
                    value
                ];
            }
        }
    }
    [Symbol.for("Deno.customInspect")]() {
        return `${this.constructor.name} []`;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImh0dHBzOi8vZGVuby5sYW5kL3gvb2FrQHYxMC4xLjAvY29va2llcy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxOC0yMDIxIHRoZSBvYWsgYXV0aG9ycy4gQWxsIHJpZ2h0cyByZXNlcnZlZC4gTUlUIGxpY2Vuc2UuXG5cbi8vIFRoaXMgd2FzIGhlYXZpbHkgaW5mbHVlbmNlZCBieVxuLy8gW2Nvb2tpZXNdKGh0dHBzOi8vZ2l0aHViLmNvbS9waWxsYXJqcy9jb29raWVzL2Jsb2IvbWFzdGVyL2luZGV4LmpzKVxuXG5pbXBvcnQgdHlwZSB7IEtleVN0YWNrIH0gZnJvbSBcIi4va2V5U3RhY2sudHNcIjtcbmltcG9ydCB0eXBlIHsgUmVxdWVzdCB9IGZyb20gXCIuL3JlcXVlc3QudHNcIjtcbmltcG9ydCB0eXBlIHsgUmVzcG9uc2UgfSBmcm9tIFwiLi9yZXNwb25zZS50c1wiO1xuXG5leHBvcnQgaW50ZXJmYWNlIENvb2tpZXNPcHRpb25zIHtcbiAga2V5cz86IEtleVN0YWNrO1xuICBzZWN1cmU/OiBib29sZWFuO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIENvb2tpZXNHZXRPcHRpb25zIHtcbiAgc2lnbmVkPzogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBDb29raWVzU2V0RGVsZXRlT3B0aW9ucyB7XG4gIGRvbWFpbj86IHN0cmluZztcbiAgZXhwaXJlcz86IERhdGU7XG4gIGh0dHBPbmx5PzogYm9vbGVhbjtcbiAgLyoqIEZvciB1c2UgaW4gc2l0dWF0aW9ucyB3aGVyZSByZXF1ZXN0cyBhcmUgcHJlc2VudGVkIHRvIERlbm8gYXMgXCJpbnNlY3VyZVwiXG4gICAqIGJ1dCBhcmUgb3RoZXJ3aXNlIHNlY3VyZSBhbmQgc28gc2VjdXJlIGNvb2tpZXMgY2FuIGJlIHRyZWF0ZWQgYXMgc2VjdXJlLiAqL1xuICBpZ25vcmVJbnNlY3VyZT86IGJvb2xlYW47XG4gIG1heEFnZT86IG51bWJlcjtcbiAgb3ZlcndyaXRlPzogYm9vbGVhbjtcbiAgcGF0aD86IHN0cmluZztcbiAgc2VjdXJlPzogYm9vbGVhbjtcbiAgc2FtZVNpdGU/OiBcInN0cmljdFwiIHwgXCJsYXhcIiB8IFwibm9uZVwiIHwgYm9vbGVhbjtcbiAgc2lnbmVkPzogYm9vbGVhbjtcbn1cblxudHlwZSBDb29raWVBdHRyaWJ1dGVzID0gQ29va2llc1NldERlbGV0ZU9wdGlvbnM7XG5cbmNvbnN0IG1hdGNoQ2FjaGU6IFJlY29yZDxzdHJpbmcsIFJlZ0V4cD4gPSB7fTtcblxuLy8gZGVuby1saW50LWlnbm9yZSBuby1jb250cm9sLXJlZ2V4XG5jb25zdCBGSUVMRF9DT05URU5UX1JFR0VYUCA9IC9eW1xcdTAwMDlcXHUwMDIwLVxcdTAwN2VcXHUwMDgwLVxcdTAwZmZdKyQvO1xuY29uc3QgS0VZX1JFR0VYUCA9IC8oPzpefDspICooW149XSopPVteO10qL2c7XG5jb25zdCBTQU1FX1NJVEVfUkVHRVhQID0gL14oPzpsYXh8bm9uZXxzdHJpY3QpJC9pO1xuXG5mdW5jdGlvbiBnZXRQYXR0ZXJuKG5hbWU6IHN0cmluZyk6IFJlZ0V4cCB7XG4gIGlmIChuYW1lIGluIG1hdGNoQ2FjaGUpIHtcbiAgICByZXR1cm4gbWF0Y2hDYWNoZVtuYW1lXTtcbiAgfVxuXG4gIHJldHVybiBtYXRjaENhY2hlW25hbWVdID0gbmV3IFJlZ0V4cChcbiAgICBgKD86Xnw7KSAqJHtuYW1lLnJlcGxhY2UoL1stW1xcXXt9KCkqKz8uLFxcXFxeJHwjXFxzXS9nLCBcIlxcXFwkJlwiKX09KFteO10qKWAsXG4gICk7XG59XG5cbmZ1bmN0aW9uIHB1c2hDb29raWUoaGVhZGVyczogc3RyaW5nW10sIGNvb2tpZTogQ29va2llKTogdm9pZCB7XG4gIGlmIChjb29raWUub3ZlcndyaXRlKSB7XG4gICAgZm9yIChsZXQgaSA9IGhlYWRlcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgIGlmIChoZWFkZXJzW2ldLmluZGV4T2YoYCR7Y29va2llLm5hbWV9PWApID09PSAwKSB7XG4gICAgICAgIGhlYWRlcnMuc3BsaWNlKGksIDEpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBoZWFkZXJzLnB1c2goY29va2llLnRvSGVhZGVyKCkpO1xufVxuXG5mdW5jdGlvbiB2YWxpZGF0ZUNvb2tpZVByb3BlcnR5KFxuICBrZXk6IHN0cmluZyxcbiAgdmFsdWU6IHN0cmluZyB8IHVuZGVmaW5lZCB8IG51bGwsXG4pOiB2b2lkIHtcbiAgaWYgKHZhbHVlICYmICFGSUVMRF9DT05URU5UX1JFR0VYUC50ZXN0KHZhbHVlKSkge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoYFRoZSAke2tleX0gb2YgdGhlIGNvb2tpZSAoJHt2YWx1ZX0pIGlzIGludmFsaWQuYCk7XG4gIH1cbn1cblxuY2xhc3MgQ29va2llIGltcGxlbWVudHMgQ29va2llQXR0cmlidXRlcyB7XG4gIGRvbWFpbj86IHN0cmluZztcbiAgZXhwaXJlcz86IERhdGU7XG4gIGh0dHBPbmx5ID0gdHJ1ZTtcbiAgbWF4QWdlPzogbnVtYmVyO1xuICBuYW1lOiBzdHJpbmc7XG4gIG92ZXJ3cml0ZSA9IGZhbHNlO1xuICBwYXRoID0gXCIvXCI7XG4gIHNhbWVTaXRlOiBcInN0cmljdFwiIHwgXCJsYXhcIiB8IFwibm9uZVwiIHwgYm9vbGVhbiA9IGZhbHNlO1xuICBzZWN1cmUgPSBmYWxzZTtcbiAgc2lnbmVkPzogYm9vbGVhbjtcbiAgdmFsdWU6IHN0cmluZztcblxuICAvKiogQSBsb2dpY2FsIHJlcHJlc2VudGF0aW9uIG9mIGEgY29va2llLCB1c2VkIHRvIGludGVybmFsbHkgbWFuYWdlIHRoZVxuICAgKiBjb29raWUgaW5zdGFuY2VzLiAqL1xuICBjb25zdHJ1Y3RvcihcbiAgICBuYW1lOiBzdHJpbmcsXG4gICAgdmFsdWU6IHN0cmluZyB8IG51bGwsXG4gICAgYXR0cmlidXRlczogQ29va2llQXR0cmlidXRlcyxcbiAgKSB7XG4gICAgdmFsaWRhdGVDb29raWVQcm9wZXJ0eShcIm5hbWVcIiwgbmFtZSk7XG4gICAgdmFsaWRhdGVDb29raWVQcm9wZXJ0eShcInZhbHVlXCIsIHZhbHVlKTtcbiAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgIHRoaXMudmFsdWUgPSB2YWx1ZSA/PyBcIlwiO1xuICAgIE9iamVjdC5hc3NpZ24odGhpcywgYXR0cmlidXRlcyk7XG4gICAgaWYgKCF0aGlzLnZhbHVlKSB7XG4gICAgICB0aGlzLmV4cGlyZXMgPSBuZXcgRGF0ZSgwKTtcbiAgICAgIHRoaXMubWF4QWdlID0gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIHZhbGlkYXRlQ29va2llUHJvcGVydHkoXCJwYXRoXCIsIHRoaXMucGF0aCk7XG4gICAgdmFsaWRhdGVDb29raWVQcm9wZXJ0eShcImRvbWFpblwiLCB0aGlzLmRvbWFpbik7XG4gICAgaWYgKFxuICAgICAgdGhpcy5zYW1lU2l0ZSAmJiB0eXBlb2YgdGhpcy5zYW1lU2l0ZSA9PT0gXCJzdHJpbmdcIiAmJlxuICAgICAgIVNBTUVfU0lURV9SRUdFWFAudGVzdCh0aGlzLnNhbWVTaXRlKVxuICAgICkge1xuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcbiAgICAgICAgYFRoZSBzYW1lU2l0ZSBvZiB0aGUgY29va2llIChcIiR7dGhpcy5zYW1lU2l0ZX1cIikgaXMgaW52YWxpZC5gLFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICB0b0hlYWRlcigpOiBzdHJpbmcge1xuICAgIGxldCBoZWFkZXIgPSB0aGlzLnRvU3RyaW5nKCk7XG4gICAgaWYgKHRoaXMubWF4QWdlKSB7XG4gICAgICB0aGlzLmV4cGlyZXMgPSBuZXcgRGF0ZShEYXRlLm5vdygpICsgKHRoaXMubWF4QWdlICogMTAwMCkpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnBhdGgpIHtcbiAgICAgIGhlYWRlciArPSBgOyBwYXRoPSR7dGhpcy5wYXRofWA7XG4gICAgfVxuICAgIGlmICh0aGlzLmV4cGlyZXMpIHtcbiAgICAgIGhlYWRlciArPSBgOyBleHBpcmVzPSR7dGhpcy5leHBpcmVzLnRvVVRDU3RyaW5nKCl9YDtcbiAgICB9XG4gICAgaWYgKHRoaXMuZG9tYWluKSB7XG4gICAgICBoZWFkZXIgKz0gYDsgZG9tYWluPSR7dGhpcy5kb21haW59YDtcbiAgICB9XG4gICAgaWYgKHRoaXMuc2FtZVNpdGUpIHtcbiAgICAgIGhlYWRlciArPSBgOyBzYW1lc2l0ZT0ke1xuICAgICAgICB0aGlzLnNhbWVTaXRlID09PSB0cnVlID8gXCJzdHJpY3RcIiA6IHRoaXMuc2FtZVNpdGUudG9Mb3dlckNhc2UoKVxuICAgICAgfWA7XG4gICAgfVxuICAgIGlmICh0aGlzLnNlY3VyZSkge1xuICAgICAgaGVhZGVyICs9IFwiOyBzZWN1cmVcIjtcbiAgICB9XG4gICAgaWYgKHRoaXMuaHR0cE9ubHkpIHtcbiAgICAgIGhlYWRlciArPSBcIjsgaHR0cG9ubHlcIjtcbiAgICB9XG5cbiAgICByZXR1cm4gaGVhZGVyO1xuICB9XG5cbiAgdG9TdHJpbmcoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gYCR7dGhpcy5uYW1lfT0ke3RoaXMudmFsdWV9YDtcbiAgfVxufVxuXG4vKiogQW4gaW50ZXJmYWNlIHdoaWNoIGFsbG93cyBzZXR0aW5nIGFuZCBhY2Nlc3NpbmcgY29va2llcyByZWxhdGVkIHRvIGJvdGggdGhlXG4gKiBjdXJyZW50IHJlcXVlc3QgYW5kIHJlc3BvbnNlLiAqL1xuZXhwb3J0IGNsYXNzIENvb2tpZXMge1xuICAjY29va2llS2V5cz86IHN0cmluZ1tdO1xuICAja2V5cz86IEtleVN0YWNrO1xuICAjcmVxdWVzdDogUmVxdWVzdDtcbiAgI3Jlc3BvbnNlOiBSZXNwb25zZTtcbiAgI3NlY3VyZT86IGJvb2xlYW47XG5cbiAgI3JlcXVlc3RLZXlzKCk6IHN0cmluZ1tdIHtcbiAgICBpZiAodGhpcy4jY29va2llS2V5cykge1xuICAgICAgcmV0dXJuIHRoaXMuI2Nvb2tpZUtleXM7XG4gICAgfVxuICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuI2Nvb2tpZUtleXMgPSBbXSBhcyBzdHJpbmdbXTtcbiAgICBjb25zdCBoZWFkZXIgPSB0aGlzLiNyZXF1ZXN0LmhlYWRlcnMuZ2V0KFwiY29va2llXCIpO1xuICAgIGlmICghaGVhZGVyKSB7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICBsZXQgbWF0Y2hlczogUmVnRXhwRXhlY0FycmF5IHwgbnVsbDtcbiAgICB3aGlsZSAoKG1hdGNoZXMgPSBLRVlfUkVHRVhQLmV4ZWMoaGVhZGVyKSkpIHtcbiAgICAgIGNvbnN0IFssIGtleV0gPSBtYXRjaGVzO1xuICAgICAgcmVzdWx0LnB1c2goa2V5KTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHJlcXVlc3Q6IFJlcXVlc3QsXG4gICAgcmVzcG9uc2U6IFJlc3BvbnNlLFxuICAgIG9wdGlvbnM6IENvb2tpZXNPcHRpb25zID0ge30sXG4gICkge1xuICAgIGNvbnN0IHsga2V5cywgc2VjdXJlIH0gPSBvcHRpb25zO1xuICAgIHRoaXMuI2tleXMgPSBrZXlzO1xuICAgIHRoaXMuI3JlcXVlc3QgPSByZXF1ZXN0O1xuICAgIHRoaXMuI3Jlc3BvbnNlID0gcmVzcG9uc2U7XG4gICAgdGhpcy4jc2VjdXJlID0gc2VjdXJlO1xuICB9XG5cbiAgLyoqIFNldCBhIGNvb2tpZSB0byBiZSBkZWxldGVkIGluIHRoZSByZXNwb25zZS4gIFRoaXMgaXMgYSBcInNob3J0Y3V0XCIgdG9cbiAgICogYC5zZXQobmFtZSwgbnVsbCwgb3B0aW9ucz8pYC4gKi9cbiAgZGVsZXRlKG5hbWU6IHN0cmluZywgb3B0aW9uczogQ29va2llc1NldERlbGV0ZU9wdGlvbnMgPSB7fSk6IGJvb2xlYW4ge1xuICAgIHRoaXMuc2V0KG5hbWUsIG51bGwsIG9wdGlvbnMpO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLyoqIEl0ZXJhdGUgb3ZlciB0aGUgcmVxdWVzdCdzIGNvb2tpZXMsIHlpZWxkaW5nIHVwIGEgdHVwbGUgY29udGFpbmluZyB0aGVcbiAgICoga2V5IGFuZCB0aGUgdmFsdWUuXG4gICAqXG4gICAqIElmIHRoZXJlIGFyZSBrZXlzIHNldCBvbiB0aGUgYXBwbGljYXRpb24sIG9ubHkga2V5cyBhbmQgdmFsdWVzIHRoYXQgYXJlXG4gICAqIHByb3Blcmx5IHNpZ25lZCB3aWxsIGJlIHJldHVybmVkLiAqL1xuICBhc3luYyAqZW50cmllcygpOiBBc3luY0l0ZXJhYmxlSXRlcmF0b3I8W3N0cmluZywgc3RyaW5nXT4ge1xuICAgIGNvbnN0IGtleXMgPSB0aGlzLiNyZXF1ZXN0S2V5cygpO1xuICAgIGZvciAoY29uc3Qga2V5IG9mIGtleXMpIHtcbiAgICAgIGNvbnN0IHZhbHVlID0gYXdhaXQgdGhpcy5nZXQoa2V5KTtcbiAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICB5aWVsZCBba2V5LCB2YWx1ZV07XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZm9yRWFjaChcbiAgICBjYWxsYmFjazogKGtleTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nLCBjb29raWVzOiB0aGlzKSA9PiB2b2lkLFxuICAgIC8vIGRlbm8tbGludC1pZ25vcmUgbm8tZXhwbGljaXQtYW55XG4gICAgdGhpc0FyZzogYW55ID0gbnVsbCxcbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3Qga2V5cyA9IHRoaXMuI3JlcXVlc3RLZXlzKCk7XG4gICAgZm9yIChjb25zdCBrZXkgb2Yga2V5cykge1xuICAgICAgY29uc3QgdmFsdWUgPSBhd2FpdCB0aGlzLmdldChrZXkpO1xuICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgIGNhbGxiYWNrLmNhbGwodGhpc0FyZywga2V5LCB2YWx1ZSwgdGhpcyk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqIEdldCB0aGUgdmFsdWUgb2YgYSBjb29raWUgZnJvbSB0aGUgcmVxdWVzdC5cbiAgICpcbiAgICogSWYgdGhlIGNvb2tpZSBpcyBzaWduZWQsIGFuZCB0aGUgc2lnbmF0dXJlIGlzIGludmFsaWQsIHRoZSBjb29raWUgd2lsbFxuICAgKiBiZSBzZXQgdG8gYmUgZGVsZXRlZCBpbiB0aGUgdGhlIHJlc3BvbnNlLiAgSWYgdGhlIHNpZ25hdHVyZSB1c2VzIGFuIFwib2xkXCJcbiAgICoga2V5LCB0aGUgY29va2llIHdpbGwgYmUgcmUtc2lnbmVkIHdpdGggdGhlIGN1cnJlbnQga2V5IGFuZCBiZSBhZGRlZCB0byB0aGVcbiAgICogcmVzcG9uc2UgdG8gYmUgdXBkYXRlZC4gKi9cbiAgYXN5bmMgZ2V0KFxuICAgIG5hbWU6IHN0cmluZyxcbiAgICBvcHRpb25zOiBDb29raWVzR2V0T3B0aW9ucyA9IHt9LFxuICApOiBQcm9taXNlPHN0cmluZyB8IHVuZGVmaW5lZD4ge1xuICAgIGNvbnN0IHNpZ25lZCA9IG9wdGlvbnMuc2lnbmVkID8/ICEhdGhpcy4ja2V5cztcbiAgICBjb25zdCBuYW1lU2lnID0gYCR7bmFtZX0uc2lnYDtcblxuICAgIGNvbnN0IGhlYWRlciA9IHRoaXMuI3JlcXVlc3QuaGVhZGVycy5nZXQoXCJjb29raWVcIik7XG4gICAgaWYgKCFoZWFkZXIpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgbWF0Y2ggPSBoZWFkZXIubWF0Y2goZ2V0UGF0dGVybihuYW1lKSk7XG4gICAgaWYgKCFtYXRjaCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBbLCB2YWx1ZV0gPSBtYXRjaDtcbiAgICBpZiAoIXNpZ25lZCkge1xuICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH1cbiAgICBjb25zdCBkaWdlc3QgPSBhd2FpdCB0aGlzLmdldChuYW1lU2lnLCB7IHNpZ25lZDogZmFsc2UgfSk7XG4gICAgaWYgKCFkaWdlc3QpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgZGF0YSA9IGAke25hbWV9PSR7dmFsdWV9YDtcbiAgICBpZiAoIXRoaXMuI2tleXMpIHtcbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJrZXlzIHJlcXVpcmVkIGZvciBzaWduZWQgY29va2llc1wiKTtcbiAgICB9XG4gICAgY29uc3QgaW5kZXggPSBhd2FpdCB0aGlzLiNrZXlzLmluZGV4T2YoZGF0YSwgZGlnZXN0KTtcblxuICAgIGlmIChpbmRleCA8IDApIHtcbiAgICAgIHRoaXMuZGVsZXRlKG5hbWVTaWcsIHsgcGF0aDogXCIvXCIsIHNpZ25lZDogZmFsc2UgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChpbmRleCkge1xuICAgICAgICAvLyB0aGUga2V5IGhhcyBcImFnZWRcIiBhbmQgbmVlZHMgdG8gYmUgcmUtc2lnbmVkXG4gICAgICAgIHRoaXMuc2V0KG5hbWVTaWcsIGF3YWl0IHRoaXMuI2tleXMuc2lnbihkYXRhKSwgeyBzaWduZWQ6IGZhbHNlIH0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH1cbiAgfVxuXG4gIC8qKiBJdGVyYXRlIG92ZXIgdGhlIHJlcXVlc3QncyBjb29raWVzLCB5aWVsZGluZyB1cCB0aGUga2V5cy5cbiAgICpcbiAgICogSWYgdGhlcmUgYXJlIGtleXMgc2V0IG9uIHRoZSBhcHBsaWNhdGlvbiwgb25seSB0aGUga2V5cyB0aGF0IGFyZSBwcm9wZXJseVxuICAgKiBzaWduZWQgd2lsbCBiZSByZXR1cm5lZC4gKi9cbiAgYXN5bmMgKmtleXMoKTogQXN5bmNJdGVyYWJsZUl0ZXJhdG9yPHN0cmluZz4ge1xuICAgIGNvbnN0IGtleXMgPSB0aGlzLiNyZXF1ZXN0S2V5cygpO1xuICAgIGZvciAoY29uc3Qga2V5IG9mIGtleXMpIHtcbiAgICAgIGNvbnN0IHZhbHVlID0gYXdhaXQgdGhpcy5nZXQoa2V5KTtcbiAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICB5aWVsZCBrZXk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqIFNldCBhIGNvb2tpZSBpbiB0aGUgcmVzcG9uc2UuXG4gICAqXG4gICAqIElmIHRoZXJlIGFyZSBrZXlzIHNldCBpbiB0aGUgYXBwbGljYXRpb24sIGNvb2tpZXMgd2lsbCBiZSBhdXRvbWF0aWNhbGx5XG4gICAqIHNpZ25lZCwgdW5sZXNzIG92ZXJyaWRkZW4gYnkgdGhlIHNldCBvcHRpb25zLiAgQ29va2llcyBjYW4gYmUgZGVsZXRlZCBieVxuICAgKiBzZXR0aW5nIHRoZSB2YWx1ZSB0byBgbnVsbGAuICovXG4gIGFzeW5jIHNldChcbiAgICBuYW1lOiBzdHJpbmcsXG4gICAgdmFsdWU6IHN0cmluZyB8IG51bGwsXG4gICAgb3B0aW9uczogQ29va2llc1NldERlbGV0ZU9wdGlvbnMgPSB7fSxcbiAgKTogUHJvbWlzZTx0aGlzPiB7XG4gICAgY29uc3QgcmVxdWVzdCA9IHRoaXMuI3JlcXVlc3Q7XG4gICAgY29uc3QgcmVzcG9uc2UgPSB0aGlzLiNyZXNwb25zZTtcbiAgICBjb25zdCBoZWFkZXJzOiBzdHJpbmdbXSA9IFtdO1xuICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIHJlc3BvbnNlLmhlYWRlcnMuZW50cmllcygpKSB7XG4gICAgICBpZiAoa2V5ID09PSBcInNldC1jb29raWVcIikge1xuICAgICAgICBoZWFkZXJzLnB1c2godmFsdWUpO1xuICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBzZWN1cmUgPSB0aGlzLiNzZWN1cmUgIT09IHVuZGVmaW5lZCA/IHRoaXMuI3NlY3VyZSA6IHJlcXVlc3Quc2VjdXJlO1xuICAgIGNvbnN0IHNpZ25lZCA9IG9wdGlvbnMuc2lnbmVkID8/ICEhdGhpcy4ja2V5cztcblxuICAgIGlmICghc2VjdXJlICYmIG9wdGlvbnMuc2VjdXJlICYmICFvcHRpb25zLmlnbm9yZUluc2VjdXJlKSB7XG4gICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFxuICAgICAgICBcIkNhbm5vdCBzZW5kIHNlY3VyZSBjb29raWUgb3ZlciB1bmVuY3J5cHRlZCBjb25uZWN0aW9uLlwiLFxuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zdCBjb29raWUgPSBuZXcgQ29va2llKG5hbWUsIHZhbHVlLCBvcHRpb25zKTtcbiAgICBjb29raWUuc2VjdXJlID0gb3B0aW9ucy5zZWN1cmUgPz8gc2VjdXJlO1xuICAgIHB1c2hDb29raWUoaGVhZGVycywgY29va2llKTtcblxuICAgIGlmIChzaWduZWQpIHtcbiAgICAgIGlmICghdGhpcy4ja2V5cykge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiLmtleXMgcmVxdWlyZWQgZm9yIHNpZ25lZCBjb29raWVzLlwiKTtcbiAgICAgIH1cbiAgICAgIGNvb2tpZS52YWx1ZSA9IGF3YWl0IHRoaXMuI2tleXMuc2lnbihjb29raWUudG9TdHJpbmcoKSk7XG4gICAgICBjb29raWUubmFtZSArPSBcIi5zaWdcIjtcbiAgICAgIHB1c2hDb29raWUoaGVhZGVycywgY29va2llKTtcbiAgICB9XG5cbiAgICByZXNwb25zZS5oZWFkZXJzLmRlbGV0ZShcIlNldC1Db29raWVcIik7XG4gICAgZm9yIChjb25zdCBoZWFkZXIgb2YgaGVhZGVycykge1xuICAgICAgcmVzcG9uc2UuaGVhZGVycy5hcHBlbmQoXCJTZXQtQ29va2llXCIsIGhlYWRlcik7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqIEl0ZXJhdGUgb3ZlciB0aGUgcmVxdWVzdCdzIGNvb2tpZXMsIHlpZWxkaW5nIHVwIGVhY2ggdmFsdWUuXG4gICAqXG4gICAqIElmIHRoZXJlIGFyZSBrZXlzIHNldCBvbiB0aGUgYXBwbGljYXRpb24sIG9ubHkgdGhlIHZhbHVlcyB0aGF0IGFyZVxuICAgKiBwcm9wZXJseSBzaWduZWQgd2lsbCBiZSByZXR1cm5lZC4gKi9cbiAgYXN5bmMgKnZhbHVlcygpOiBBc3luY0l0ZXJhYmxlSXRlcmF0b3I8c3RyaW5nPiB7XG4gICAgY29uc3Qga2V5cyA9IHRoaXMuI3JlcXVlc3RLZXlzKCk7XG4gICAgZm9yIChjb25zdCBrZXkgb2Yga2V5cykge1xuICAgICAgY29uc3QgdmFsdWUgPSBhd2FpdCB0aGlzLmdldChrZXkpO1xuICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgIHlpZWxkIHZhbHVlO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKiBJdGVyYXRlIG92ZXIgdGhlIHJlcXVlc3QncyBjb29raWVzLCB5aWVsZGluZyB1cCBhIHR1cGxlIGNvbnRhaW5pbmcgdGhlXG4gICAqIGtleSBhbmQgdGhlIHZhbHVlLlxuICAgKlxuICAgKiBJZiB0aGVyZSBhcmUga2V5cyBzZXQgb24gdGhlIGFwcGxpY2F0aW9uLCBvbmx5IGtleXMgYW5kIHZhbHVlcyB0aGF0IGFyZVxuICAgKiBwcm9wZXJseSBzaWduZWQgd2lsbCBiZSByZXR1cm5lZC4gKi9cbiAgYXN5bmMgKltTeW1ib2wuYXN5bmNJdGVyYXRvcl0oKTogQXN5bmNJdGVyYWJsZUl0ZXJhdG9yPFtzdHJpbmcsIHN0cmluZ10+IHtcbiAgICBjb25zdCBrZXlzID0gdGhpcy4jcmVxdWVzdEtleXMoKTtcbiAgICBmb3IgKGNvbnN0IGtleSBvZiBrZXlzKSB7XG4gICAgICBjb25zdCB2YWx1ZSA9IGF3YWl0IHRoaXMuZ2V0KGtleSk7XG4gICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgeWllbGQgW2tleSwgdmFsdWVdO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIFtTeW1ib2wuZm9yKFwiRGVuby5jdXN0b21JbnNwZWN0XCIpXSgpIHtcbiAgICByZXR1cm4gYCR7dGhpcy5jb25zdHJ1Y3Rvci5uYW1lfSBbXWA7XG4gIH1cbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFtQ0EsS0FBSyxDQUFDLFVBQVUsR0FBMkIsQ0FBQztBQUFBLENBQUM7QUFFN0MsRUFBb0MsQUFBcEMsa0NBQW9DO0FBQ3BDLEtBQUssQ0FBQyxvQkFBb0I7QUFDMUIsS0FBSyxDQUFDLFVBQVU7QUFDaEIsS0FBSyxDQUFDLGdCQUFnQjtTQUViLFVBQVUsQ0FBQyxJQUFZLEVBQVUsQ0FBQztJQUN6QyxFQUFFLEVBQUUsSUFBSSxJQUFJLFVBQVUsRUFBRSxDQUFDO1FBQ3ZCLE1BQU0sQ0FBQyxVQUFVLENBQUMsSUFBSTtJQUN4QixDQUFDO0lBRUQsTUFBTSxDQUFDLFVBQVUsQ0FBQyxJQUFJLElBQUksR0FBRyxDQUFDLE1BQU0sRUFDakMsU0FBUyxFQUFF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