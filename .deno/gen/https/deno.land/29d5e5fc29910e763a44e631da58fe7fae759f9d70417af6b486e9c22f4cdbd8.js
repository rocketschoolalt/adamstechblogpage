import { assert } from "./util.ts";
const encoder = new TextEncoder();
const DEFAULT_KEEP_ALIVE_INTERVAL = 30000;
class CloseEvent extends Event {
    constructor(eventInit){
        super("close", eventInit);
    }
}
/** An event which contains information which will be sent to the remote
 * connection and be made available in an `EventSource` as an event. */ export class ServerSentEvent extends Event {
    #data;
    #id;
    #type;
    constructor(type, // deno-lint-ignore no-explicit-any
    data, { replacer , space , ...eventInit } = {
    }){
        super(type, eventInit);
        this.#type = type;
        try {
            this.#data = typeof data === "string" ? data : JSON.stringify(data, replacer, space);
        } catch (e) {
            assert(e instanceof Error);
            throw new TypeError(`data could not be coerced into a serialized string.\n  ${e.message}`);
        }
        const { id  } = eventInit;
        this.#id = id;
    }
    /** The data associated with the event, which will be sent to the client and
   * be made available in the `EventSource`. */ get data() {
        return this.#data;
    }
    /** The optional ID associated with the event that will be sent to the client
   * and be made available in the `EventSource`. */ get id() {
        return this.#id;
    }
    toString() {
        const data = `data: ${this.#data.split("\n").join("\ndata: ")}\n`;
        return `${this.#type === "__message" ? "" : `event: ${this.#type}\n`}${this.#id ? `id: ${String(this.#id)}\n` : ""}${data}\n`;
    }
}
const responseHeaders = new Headers([
    [
        "Connection",
        "Keep-Alive"
    ],
    [
        "Content-Type",
        "text/event-stream"
    ],
    [
        "Cache-Control",
        "no-cache"
    ],
    [
        "Keep-Alive",
        `timeout=${Number.MAX_SAFE_INTEGER}`
    ], 
]);
export class SSEStreamTarget extends EventTarget {
    #closed = false;
    #context;
    #controller;
    #keepAliveId;
    // deno-lint-ignore no-explicit-any
     #error(error) {
        console.log("error", error);
        this.dispatchEvent(new CloseEvent({
            cancelable: false
        }));
        const errorEvent = new ErrorEvent("error", {
            error
        });
        this.dispatchEvent(errorEvent);
        this.#context.app.dispatchEvent(errorEvent);
    }
     #push(payload) {
        if (!this.#controller) {
            this.#error(new Error("The controller has not been set."));
            return;
        }
        if (this.#closed) {
            return;
        }
        this.#controller.enqueue(encoder.encode(payload));
    }
    get closed() {
        return this.#closed;
    }
    constructor(context, { headers , keepAlive =false  } = {
    }){
        super();
        this.#context = context;
        context.response.body = new ReadableStream({
            start: (controller)=>{
                this.#controller = controller;
            },
            cancel: (error)=>{
                // connections closing are considered "normal" for SSE events and just
                // mean the far side has closed.
                if (error instanceof Error && error.message.includes("connection closed")) {
                    this.close();
                } else {
                    this.#error(error);
                }
            }
        });
        if (headers) {
            for (const [key, value] of headers){
                context.response.headers.set(key, value);
            }
        }
        for (const [key, value] of responseHeaders){
            context.response.headers.set(key, value);
        }
        this.addEventListener("close", ()=>{
            this.#closed = true;
            if (this.#keepAliveId != null) {
                clearInterval(this.#keepAliveId);
                this.#keepAliveId = undefined;
            }
            if (this.#controller) {
                try {
                    this.#controller.close();
                } catch  {
                // we ignore any errors here, as it is likely that the controller
                // is already closed
                }
            }
        });
        if (keepAlive) {
            const interval = typeof keepAlive === "number" ? keepAlive : DEFAULT_KEEP_ALIVE_INTERVAL;
            this.#keepAliveId = setInterval(()=>{
                this.dispatchComment("keep-alive comment");
            }, interval);
        }
    }
    close() {
        this.dispatchEvent(new CloseEvent({
            cancelable: false
        }));
        return Promise.resolve();
    }
    dispatchComment(comment) {
        this.#push(`: ${comment.split("\n").join("\n: ")}\n\n`);
        return true;
    }
    // deno-lint-ignore no-explicit-any
    dispatchMessage(data) {
        const event = new ServerSentEvent("__message", data);
        return this.dispatchEvent(event);
    }
    dispatchEvent(event) {
        const dispatched = super.dispatchEvent(event);
        if (dispatched && event instanceof ServerSentEvent) {
            this.#push(String(event));
        }
        return dispatched;
    }
    [Symbol.for("Deno.customInspect")](inspect) {
        return `${this.constructor.name} ${inspect({
            "#closed": this.#closed,
            "#context": this.#context
        })}`;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImh0dHBzOi8vZGVuby5sYW5kL3gvb2FrQHYxMC4xLjAvc2VydmVyX3NlbnRfZXZlbnQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTgtMjAyMSB0aGUgb2FrIGF1dGhvcnMuIEFsbCByaWdodHMgcmVzZXJ2ZWQuIE1JVCBsaWNlbnNlLlxuXG5pbXBvcnQgdHlwZSB7IENvbnRleHQgfSBmcm9tIFwiLi9jb250ZXh0LnRzXCI7XG5pbXBvcnQgeyBhc3NlcnQgfSBmcm9tIFwiLi91dGlsLnRzXCI7XG5cbmNvbnN0IGVuY29kZXIgPSBuZXcgVGV4dEVuY29kZXIoKTtcblxuY29uc3QgREVGQVVMVF9LRUVQX0FMSVZFX0lOVEVSVkFMID0gMzBfMDAwO1xuXG5leHBvcnQgaW50ZXJmYWNlIFNlcnZlclNlbnRFdmVudEluaXQgZXh0ZW5kcyBFdmVudEluaXQge1xuICAvKiogQW4gb3B0aW9uYWwgYGlkYCB3aGljaCB3aWxsIGJlIHNlbnQgd2l0aCB0aGUgZXZlbnQgYW5kIGV4cG9zZWQgaW4gdGhlXG4gICAqIGNsaWVudCBgRXZlbnRTb3VyY2VgLiAqL1xuICBpZD86IG51bWJlcjtcblxuICAvKiogVGhlIHJlcGxhY2VyIGlzIHBhc3NlZCB0byBgSlNPTi5zdHJpbmdpZnlgIHdoZW4gY29udmVydGluZyB0aGUgYGRhdGFgXG4gICAqIHByb3BlcnR5IHRvIGEgSlNPTiBzdHJpbmcuICovXG4gIHJlcGxhY2VyPzpcbiAgICB8IChzdHJpbmcgfCBudW1iZXIpW11cbiAgICAvLyBkZW5vLWxpbnQtaWdub3JlIG5vLWV4cGxpY2l0LWFueVxuICAgIHwgKCh0aGlzOiBhbnksIGtleTogc3RyaW5nLCB2YWx1ZTogYW55KSA9PiBhbnkpO1xuXG4gIC8qKiBTcGFjZSBpcyBwYXNzZWQgdG8gYEpTT04uc3RyaW5naWZ5YCB3aGVuIGNvbnZlcnRpbmcgdGhlIGBkYXRhYCBwcm9wZXJ0eVxuICAgKiB0byBhIEpTT04gc3RyaW5nLiAqL1xuICBzcGFjZT86IHN0cmluZyB8IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTZXJ2ZXJTZW50RXZlbnRUYXJnZXRPcHRpb25zIHtcbiAgLyoqIEFkZGl0aW9uYWwgaGVhZGVycyB0byBzZW5kIHRvIHRoZSBjbGllbnQgZHVyaW5nIHN0YXJ0dXAuICBUaGVzZSBoZWFkZXJzXG4gICAqIHdpbGwgb3ZlcndyaXRlIGFueSBvZiB0aGUgZGVmYXVsdCBoZWFkZXJzIGlmIHRoZSBrZXkgaXMgZHVwbGljYXRlZC4gKi9cbiAgaGVhZGVycz86IEhlYWRlcnM7XG4gIC8qKiBLZWVwIGNsaWVudCBjb25uZWN0aW9ucyBhbGl2ZSBieSBzZW5kaW5nIGEgY29tbWVudCBldmVudCB0byB0aGUgY2xpZW50XG4gICAqIGF0IGEgc3BlY2lmaWVkIGludGVydmFsLiAgSWYgYHRydWVgLCB0aGVuIGl0IHBvbGxzIGV2ZXJ5IDMwMDAwIG1pbGxpc2Vjb25kc1xuICAgKiAoMzAgc2Vjb25kcykuIElmIHNldCB0byBhIG51bWJlciwgdGhlbiBpdCBwb2xscyB0aGF0IG51bWJlciBvZlxuICAgKiBtaWxsaXNlY29uZHMuICBUaGUgZmVhdHVyZSBpcyBkaXNhYmxlZCBpZiBzZXQgdG8gYGZhbHNlYC4gIEl0IGRlZmF1bHRzIHRvXG4gICAqIGBmYWxzZWAuICovXG4gIGtlZXBBbGl2ZT86IGJvb2xlYW4gfCBudW1iZXI7XG59XG5cbmNsYXNzIENsb3NlRXZlbnQgZXh0ZW5kcyBFdmVudCB7XG4gIGNvbnN0cnVjdG9yKGV2ZW50SW5pdDogRXZlbnRJbml0KSB7XG4gICAgc3VwZXIoXCJjbG9zZVwiLCBldmVudEluaXQpO1xuICB9XG59XG5cbi8qKiBBbiBldmVudCB3aGljaCBjb250YWlucyBpbmZvcm1hdGlvbiB3aGljaCB3aWxsIGJlIHNlbnQgdG8gdGhlIHJlbW90ZVxuICogY29ubmVjdGlvbiBhbmQgYmUgbWFkZSBhdmFpbGFibGUgaW4gYW4gYEV2ZW50U291cmNlYCBhcyBhbiBldmVudC4gKi9cbmV4cG9ydCBjbGFzcyBTZXJ2ZXJTZW50RXZlbnQgZXh0ZW5kcyBFdmVudCB7XG4gICNkYXRhOiBzdHJpbmc7XG4gICNpZD86IG51bWJlcjtcbiAgI3R5cGU6IHN0cmluZztcblxuICBjb25zdHJ1Y3RvcihcbiAgICB0eXBlOiBzdHJpbmcsXG4gICAgLy8gZGVuby1saW50LWlnbm9yZSBuby1leHBsaWNpdC1hbnlcbiAgICBkYXRhOiBhbnksXG4gICAgeyByZXBsYWNlciwgc3BhY2UsIC4uLmV2ZW50SW5pdCB9OiBTZXJ2ZXJTZW50RXZlbnRJbml0ID0ge30sXG4gICkge1xuICAgIHN1cGVyKHR5cGUsIGV2ZW50SW5pdCk7XG4gICAgdGhpcy4jdHlwZSA9IHR5cGU7XG4gICAgdHJ5IHtcbiAgICAgIHRoaXMuI2RhdGEgPSB0eXBlb2YgZGF0YSA9PT0gXCJzdHJpbmdcIlxuICAgICAgICA/IGRhdGFcbiAgICAgICAgOiBKU09OLnN0cmluZ2lmeShkYXRhLCByZXBsYWNlciBhcyAoc3RyaW5nIHwgbnVtYmVyKVtdLCBzcGFjZSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgYXNzZXJ0KGUgaW5zdGFuY2VvZiBFcnJvcik7XG4gICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFxuICAgICAgICBgZGF0YSBjb3VsZCBub3QgYmUgY29lcmNlZCBpbnRvIGEgc2VyaWFsaXplZCBzdHJpbmcuXFxuICAke2UubWVzc2FnZX1gLFxuICAgICAgKTtcbiAgICB9XG4gICAgY29uc3QgeyBpZCB9ID0gZXZlbnRJbml0O1xuICAgIHRoaXMuI2lkID0gaWQ7XG4gIH1cblxuICAvKiogVGhlIGRhdGEgYXNzb2NpYXRlZCB3aXRoIHRoZSBldmVudCwgd2hpY2ggd2lsbCBiZSBzZW50IHRvIHRoZSBjbGllbnQgYW5kXG4gICAqIGJlIG1hZGUgYXZhaWxhYmxlIGluIHRoZSBgRXZlbnRTb3VyY2VgLiAqL1xuICBnZXQgZGF0YSgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLiNkYXRhO1xuICB9XG5cbiAgLyoqIFRoZSBvcHRpb25hbCBJRCBhc3NvY2lhdGVkIHdpdGggdGhlIGV2ZW50IHRoYXQgd2lsbCBiZSBzZW50IHRvIHRoZSBjbGllbnRcbiAgICogYW5kIGJlIG1hZGUgYXZhaWxhYmxlIGluIHRoZSBgRXZlbnRTb3VyY2VgLiAqL1xuICBnZXQgaWQoKTogbnVtYmVyIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy4jaWQ7XG4gIH1cblxuICB0b1N0cmluZygpOiBzdHJpbmcge1xuICAgIGNvbnN0IGRhdGEgPSBgZGF0YTogJHt0aGlzLiNkYXRhLnNwbGl0KFwiXFxuXCIpLmpvaW4oXCJcXG5kYXRhOiBcIil9XFxuYDtcbiAgICByZXR1cm4gYCR7dGhpcy4jdHlwZSA9PT0gXCJfX21lc3NhZ2VcIiA/IFwiXCIgOiBgZXZlbnQ6ICR7dGhpcy4jdHlwZX1cXG5gfSR7XG4gICAgICB0aGlzLiNpZCA/IGBpZDogJHtTdHJpbmcodGhpcy4jaWQpfVxcbmAgOiBcIlwiXG4gICAgfSR7ZGF0YX1cXG5gO1xuICB9XG59XG5cbmNvbnN0IHJlc3BvbnNlSGVhZGVycyA9IG5ldyBIZWFkZXJzKFxuICBbXG4gICAgW1wiQ29ubmVjdGlvblwiLCBcIktlZXAtQWxpdmVcIl0sXG4gICAgW1wiQ29udGVudC1UeXBlXCIsIFwidGV4dC9ldmVudC1zdHJlYW1cIl0sXG4gICAgW1wiQ2FjaGUtQ29udHJvbFwiLCBcIm5vLWNhY2hlXCJdLFxuICAgIFtcIktlZXAtQWxpdmVcIiwgYHRpbWVvdXQ9JHtOdW1iZXIuTUFYX1NBRkVfSU5URUdFUn1gXSxcbiAgXSxcbik7XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2VydmVyU2VudEV2ZW50VGFyZ2V0IGV4dGVuZHMgRXZlbnRUYXJnZXQge1xuICAvKiogSXMgc2V0IHRvIGB0cnVlYCBpZiBldmVudHMgY2Fubm90IGJlIHNlbnQgdG8gdGhlIHJlbW90ZSBjb25uZWN0aW9uLlxuICAgKiBPdGhlcndpc2UgaXQgaXMgc2V0IHRvIGBmYWxzZWAuXG4gICAqXG4gICAqICpOb3RlKjogVGhpcyBmbGFnIGlzIGxhemlseSBzZXQsIGFuZCBtaWdodCBub3QgcmVmbGVjdCBhIGNsb3NlZCBzdGF0ZSB1bnRpbFxuICAgKiBhbm90aGVyIGV2ZW50LCBjb21tZW50IG9yIG1lc3NhZ2UgaXMgYXR0ZW1wdGVkIHRvIGJlIHByb2Nlc3NlZC4gKi9cbiAgcmVhZG9ubHkgY2xvc2VkOiBib29sZWFuO1xuXG4gIC8qKiBDbG9zZSB0aGUgdGFyZ2V0LCByZWZ1c2luZyB0byBhY2NlcHQgYW55IG1vcmUgZXZlbnRzLiAqL1xuICBjbG9zZSgpOiBQcm9taXNlPHZvaWQ+O1xuXG4gIC8qKiBTZW5kIGEgY29tbWVudCB0byB0aGUgcmVtb3RlIGNvbm5lY3Rpb24uICBDb21tZW50cyBhcmUgbm90IGV4cG9zZWQgdG8gdGhlXG4gICAqIGNsaWVudCBgRXZlbnRTb3VyY2VgIGJ1dCBhcmUgdXNlZCBmb3IgZGlhZ25vc3RpY3MgYW5kIGhlbHBpbmcgZW5zdXJlIGFcbiAgICogY29ubmVjdGlvbiBpcyBrZXB0IGFsaXZlLlxuICAgKlxuICAgKiBgYGB0c1xuICAgKiBpbXBvcnQgeyBBcHBsaWNhdGlvbiB9IGZyb20gXCJodHRwczovL2Rlbm8ubGFuZC94L29hay9tb2QudHNcIjtcbiAgICpcbiAgICogY29uc3QgYXBwID0gbmV3IEFwcGxpY2F0aW9uKCk7XG4gICAqXG4gICAqIGFwcC51c2UoKGN0eCkgPT4ge1xuICAgKiAgICBjb25zdCBzc2UgPSBjdHguZ2V0U1NFVGFyZ2V0KCk7XG4gICAqICAgIHNzZS5kaXNwYXRjaENvbW1lbnQoXCJ0aGlzIGlzIGEgY29tbWVudFwiKTtcbiAgICogfSk7XG4gICAqXG4gICAqIGF3YWl0IGFwcC5saXN0ZW4oKTtcbiAgICogYGBgXG4gICAqL1xuICBkaXNwYXRjaENvbW1lbnQoY29tbWVudDogc3RyaW5nKTogYm9vbGVhbjtcblxuICAvKiogRGlzcGF0Y2ggYSBtZXNzYWdlIHRvIHRoZSBjbGllbnQuICBUaGlzIG1lc3NhZ2Ugd2lsbCBjb250YWluIGBkYXRhOiBgIG9ubHlcbiAgICogYW5kIGJlIGF2YWlsYWJsZSBvbiB0aGUgY2xpZW50IGBFdmVudFNvdXJjZWAgb24gdGhlIGBvbm1lc3NhZ2VgIG9yIGFuIGV2ZW50XG4gICAqIGxpc3RlbmVyIG9mIHR5cGUgYFwibWVzc2FnZVwiYC4gKi9cbiAgLy8gZGVuby1saW50LWlnbm9yZSBuby1leHBsaWNpdC1hbnlcbiAgZGlzcGF0Y2hNZXNzYWdlKGRhdGE6IGFueSk6IGJvb2xlYW47XG5cbiAgLyoqIERpc3BhdGNoIGEgc2VydmVyIHNlbnQgZXZlbnQgdG8gdGhlIGNsaWVudC4gIFRoZSBldmVudCBgdHlwZWAgd2lsbCBiZVxuICAgKiBzZW50IGFzIGBldmVudDogYCB0byB0aGUgY2xpZW50IHdoaWNoIHdpbGwgYmUgcmFpc2VkIGFzIGEgYE1lc3NhZ2VFdmVudGBcbiAgICogb24gdGhlIGBFdmVudFNvdXJjZWAgaW4gdGhlIGNsaWVudC5cbiAgICpcbiAgICogQW55IGxvY2FsIGV2ZW50IGhhbmRsZXJzIHdpbGwgYmUgZGlzcGF0Y2hlZCB0byBmaXJzdCwgYW5kIGlmIHRoZSBldmVudFxuICAgKiBpcyBjYW5jZWxsZWQsIGl0IHdpbGwgbm90IGJlIHNlbnQgdG8gdGhlIGNsaWVudC5cbiAgICpcbiAgICogYGBgdHNcbiAgICogaW1wb3J0IHsgQXBwbGljYXRpb24sIFNlcnZlclNlbnRFdmVudCB9IGZyb20gXCJodHRwczovL2Rlbm8ubGFuZC94L29hay9tb2QudHNcIjtcbiAgICpcbiAgICogY29uc3QgYXBwID0gbmV3IEFwcGxpY2F0aW9uKCk7XG4gICAqXG4gICAqIGFwcC51c2UoKGN0eCkgPT4ge1xuICAgKiAgICBjb25zdCBzc2UgPSBjdHguZ2V0U1NFVGFyZ2V0KCk7XG4gICAqICAgIGNvbnN0IGV2dCA9IG5ldyBTZXJ2ZXJTZW50RXZlbnQoXCJwaW5nXCIsIFwiaGVsbG9cIik7XG4gICAqICAgIHNzZS5kaXNwYXRjaEV2ZW50KGV2dCk7XG4gICAqIH0pO1xuICAgKlxuICAgKiBhd2FpdCBhcHAubGlzdGVuKCk7XG4gICAqIGBgYFxuICAgKi9cbiAgZGlzcGF0Y2hFdmVudChldmVudDogU2VydmVyU2VudEV2ZW50KTogYm9vbGVhbjtcblxuICAvKiogRGlzcGF0Y2ggYSBzZXJ2ZXIgc2VudCBldmVudCB0byB0aGUgY2xpZW50LiAgVGhlIGV2ZW50IGB0eXBlYCB3aWxsIGJlXG4gICAqIHNlbnQgYXMgYGV2ZW50OiBgIHRvIHRoZSBjbGllbnQgd2hpY2ggd2lsbCBiZSByYWlzZWQgYXMgYSBgTWVzc2FnZUV2ZW50YFxuICAgKiBvbiB0aGUgYEV2ZW50U291cmNlYCBpbiB0aGUgY2xpZW50LlxuICAgKlxuICAgKiBBbnkgbG9jYWwgZXZlbnQgaGFuZGxlcnMgd2lsbCBiZSBkaXNwYXRjaGVkIHRvIGZpcnN0LCBhbmQgaWYgdGhlIGV2ZW50XG4gICAqIGlzIGNhbmNlbGxlZCwgaXQgd2lsbCBub3QgYmUgc2VudCB0byB0aGUgY2xpZW50LlxuICAgKlxuICAgKiBgYGB0c1xuICAgKiBpbXBvcnQgeyBBcHBsaWNhdGlvbiwgU2VydmVyU2VudEV2ZW50IH0gZnJvbSBcImh0dHBzOi8vZGVuby5sYW5kL3gvb2FrL21vZC50c1wiO1xuICAgKlxuICAgKiBjb25zdCBhcHAgPSBuZXcgQXBwbGljYXRpb24oKTtcbiAgICpcbiAgICogYXBwLnVzZSgoY3R4KSA9PiB7XG4gICAqICAgIGNvbnN0IHNzZSA9IGN0eC5nZXRTU0VUYXJnZXQoKTtcbiAgICogICAgY29uc3QgZXZ0ID0gbmV3IFNlcnZlclNlbnRFdmVudChcInBpbmdcIiwgXCJoZWxsb1wiKTtcbiAgICogICAgc3NlLmRpc3BhdGNoRXZlbnQoZXZ0KTtcbiAgICogfSk7XG4gICAqXG4gICAqIGF3YWl0IGFwcC5saXN0ZW4oKTtcbiAgICogYGBgXG4gICAqL1xuICBkaXNwYXRjaEV2ZW50KGV2ZW50OiBDbG9zZUV2ZW50IHwgRXJyb3JFdmVudCk6IGJvb2xlYW47XG59XG5cbmV4cG9ydCBjbGFzcyBTU0VTdHJlYW1UYXJnZXQgZXh0ZW5kcyBFdmVudFRhcmdldFxuICBpbXBsZW1lbnRzIFNlcnZlclNlbnRFdmVudFRhcmdldCB7XG4gICNjbG9zZWQgPSBmYWxzZTtcbiAgI2NvbnRleHQ6IENvbnRleHQ7XG4gICNjb250cm9sbGVyPzogUmVhZGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlcjxVaW50OEFycmF5PjtcbiAgI2tlZXBBbGl2ZUlkPzogbnVtYmVyO1xuXG4gIC8vIGRlbm8tbGludC1pZ25vcmUgbm8tZXhwbGljaXQtYW55XG4gICNlcnJvcihlcnJvcjogYW55KSB7XG4gICAgY29uc29sZS5sb2coXCJlcnJvclwiLCBlcnJvcik7XG4gICAgdGhpcy5kaXNwYXRjaEV2ZW50KG5ldyBDbG9zZUV2ZW50KHsgY2FuY2VsYWJsZTogZmFsc2UgfSkpO1xuICAgIGNvbnN0IGVycm9yRXZlbnQgPSBuZXcgRXJyb3JFdmVudChcImVycm9yXCIsIHsgZXJyb3IgfSk7XG4gICAgdGhpcy5kaXNwYXRjaEV2ZW50KGVycm9yRXZlbnQpO1xuICAgIHRoaXMuI2NvbnRleHQuYXBwLmRpc3BhdGNoRXZlbnQoZXJyb3JFdmVudCk7XG4gIH1cblxuICAjcHVzaChwYXlsb2FkOiBzdHJpbmcpIHtcbiAgICBpZiAoIXRoaXMuI2NvbnRyb2xsZXIpIHtcbiAgICAgIHRoaXMuI2Vycm9yKG5ldyBFcnJvcihcIlRoZSBjb250cm9sbGVyIGhhcyBub3QgYmVlbiBzZXQuXCIpKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHRoaXMuI2Nsb3NlZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLiNjb250cm9sbGVyLmVucXVldWUoZW5jb2Rlci5lbmNvZGUocGF5bG9hZCkpO1xuICB9XG5cbiAgZ2V0IGNsb3NlZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy4jY2xvc2VkO1xuICB9XG5cbiAgY29uc3RydWN0b3IoXG4gICAgY29udGV4dDogQ29udGV4dCxcbiAgICB7IGhlYWRlcnMsIGtlZXBBbGl2ZSA9IGZhbHNlIH06IFNlcnZlclNlbnRFdmVudFRhcmdldE9wdGlvbnMgPSB7fSxcbiAgKSB7XG4gICAgc3VwZXIoKTtcblxuICAgIHRoaXMuI2NvbnRleHQgPSBjb250ZXh0O1xuXG4gICAgY29udGV4dC5yZXNwb25zZS5ib2R5ID0gbmV3IFJlYWRhYmxlU3RyZWFtPFVpbnQ4QXJyYXk+KHtcbiAgICAgIHN0YXJ0OiAoY29udHJvbGxlcikgPT4ge1xuICAgICAgICB0aGlzLiNjb250cm9sbGVyID0gY29udHJvbGxlcjtcbiAgICAgIH0sXG4gICAgICBjYW5jZWw6IChlcnJvcikgPT4ge1xuICAgICAgICAvLyBjb25uZWN0aW9ucyBjbG9zaW5nIGFyZSBjb25zaWRlcmVkIFwibm9ybWFsXCIgZm9yIFNTRSBldmVudHMgYW5kIGp1c3RcbiAgICAgICAgLy8gbWVhbiB0aGUgZmFyIHNpZGUgaGFzIGNsb3NlZC5cbiAgICAgICAgaWYgKFxuICAgICAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgJiYgZXJyb3IubWVzc2FnZS5pbmNsdWRlcyhcImNvbm5lY3Rpb24gY2xvc2VkXCIpXG4gICAgICAgICkge1xuICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLiNlcnJvcihlcnJvcik7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBpZiAoaGVhZGVycykge1xuICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgaGVhZGVycykge1xuICAgICAgICBjb250ZXh0LnJlc3BvbnNlLmhlYWRlcnMuc2V0KGtleSwgdmFsdWUpO1xuICAgICAgfVxuICAgIH1cbiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiByZXNwb25zZUhlYWRlcnMpIHtcbiAgICAgIGNvbnRleHQucmVzcG9uc2UuaGVhZGVycy5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgfVxuXG4gICAgdGhpcy5hZGRFdmVudExpc3RlbmVyKFwiY2xvc2VcIiwgKCkgPT4ge1xuICAgICAgdGhpcy4jY2xvc2VkID0gdHJ1ZTtcbiAgICAgIGlmICh0aGlzLiNrZWVwQWxpdmVJZCAhPSBudWxsKSB7XG4gICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy4ja2VlcEFsaXZlSWQpO1xuICAgICAgICB0aGlzLiNrZWVwQWxpdmVJZCA9IHVuZGVmaW5lZDtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLiNjb250cm9sbGVyKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgdGhpcy4jY29udHJvbGxlci5jbG9zZSgpO1xuICAgICAgICB9IGNhdGNoIHtcbiAgICAgICAgICAvLyB3ZSBpZ25vcmUgYW55IGVycm9ycyBoZXJlLCBhcyBpdCBpcyBsaWtlbHkgdGhhdCB0aGUgY29udHJvbGxlclxuICAgICAgICAgIC8vIGlzIGFscmVhZHkgY2xvc2VkXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGlmIChrZWVwQWxpdmUpIHtcbiAgICAgIGNvbnN0IGludGVydmFsID0gdHlwZW9mIGtlZXBBbGl2ZSA9PT0gXCJudW1iZXJcIlxuICAgICAgICA/IGtlZXBBbGl2ZVxuICAgICAgICA6IERFRkFVTFRfS0VFUF9BTElWRV9JTlRFUlZBTDtcbiAgICAgIHRoaXMuI2tlZXBBbGl2ZUlkID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgICB0aGlzLmRpc3BhdGNoQ29tbWVudChcImtlZXAtYWxpdmUgY29tbWVudFwiKTtcbiAgICAgIH0sIGludGVydmFsKTtcbiAgICB9XG4gIH1cblxuICBjbG9zZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0aGlzLmRpc3BhdGNoRXZlbnQobmV3IENsb3NlRXZlbnQoeyBjYW5jZWxhYmxlOiBmYWxzZSB9KSk7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICB9XG5cbiAgZGlzcGF0Y2hDb21tZW50KGNvbW1lbnQ6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIHRoaXMuI3B1c2goYDogJHtjb21tZW50LnNwbGl0KFwiXFxuXCIpLmpvaW4oXCJcXG46IFwiKX1cXG5cXG5gKTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8vIGRlbm8tbGludC1pZ25vcmUgbm8tZXhwbGljaXQtYW55XG4gIGRpc3BhdGNoTWVzc2FnZShkYXRhOiBhbnkpOiBib29sZWFuIHtcbiAgICBjb25zdCBldmVudCA9IG5ldyBTZXJ2ZXJTZW50RXZlbnQoXCJfX21lc3NhZ2VcIiwgZGF0YSk7XG4gICAgcmV0dXJuIHRoaXMuZGlzcGF0Y2hFdmVudChldmVudCk7XG4gIH1cblxuICBkaXNwYXRjaEV2ZW50KGV2ZW50OiBTZXJ2ZXJTZW50RXZlbnQpOiBib29sZWFuO1xuICBkaXNwYXRjaEV2ZW50KGV2ZW50OiBDbG9zZUV2ZW50IHwgRXJyb3JFdmVudCk6IGJvb2xlYW47XG4gIGRpc3BhdGNoRXZlbnQoZXZlbnQ6IFNlcnZlclNlbnRFdmVudCB8IENsb3NlRXZlbnQgfCBFcnJvckV2ZW50KTogYm9vbGVhbiB7XG4gICAgY29uc3QgZGlzcGF0Y2hlZCA9IHN1cGVyLmRpc3BhdGNoRXZlbnQoZXZlbnQpO1xuICAgIGlmIChkaXNwYXRjaGVkICYmIGV2ZW50IGluc3RhbmNlb2YgU2VydmVyU2VudEV2ZW50KSB7XG4gICAgICB0aGlzLiNwdXNoKFN0cmluZyhldmVudCkpO1xuICAgIH1cbiAgICByZXR1cm4gZGlzcGF0Y2hlZDtcbiAgfVxuXG4gIFtTeW1ib2wuZm9yKFwiRGVuby5jdXN0b21JbnNwZWN0XCIpXShpbnNwZWN0OiAodmFsdWU6IHVua25vd24pID0+IHN0cmluZykge1xuICAgIHJldHVybiBgJHt0aGlzLmNvbnN0cnVjdG9yLm5hbWV9ICR7XG4gICAgICBpbnNwZWN0KHsgXCIjY2xvc2VkXCI6IHRoaXMuI2Nsb3NlZCwgXCIjY29udGV4dFwiOiB0aGlzLiNjb250ZXh0IH0pXG4gICAgfWA7XG4gIH1cbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFHQSxNQUFNLEdBQUcsTUFBTSxRQUFRLENBQVc7QUFFbEMsS0FBSyxDQUFDLE9BQU8sR0FBRyxHQUFHLENBQUMsV0FBVztBQUUvQixLQUFLLENBQUMsMkJBQTJCLEdBQUcsS0FBTTtNQStCcEMsVUFBVSxT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