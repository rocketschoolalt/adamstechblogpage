// Copyright 2018-2022 the Deno authors. All rights reserved. MIT license.
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.
// This module ports:
// - https://github.com/nodejs/node/blob/master/src/stream_base-inl.h
// - https://github.com/nodejs/node/blob/master/src/stream_base.h
// - https://github.com/nodejs/node/blob/master/src/stream_base.cc
// - https://github.com/nodejs/node/blob/master/src/stream_wrap.h
// - https://github.com/nodejs/node/blob/master/src/stream_wrap.cc
import { Buffer } from "../buffer.ts";
import { notImplemented } from "../_utils.ts";
import { HandleWrap } from "./handle_wrap.ts";
import { AsyncWrap, providerType } from "./async_wrap.ts";
import { codeMap } from "./uv.ts";
import { writeAll } from "../../streams/conversion.ts";
var StreamBaseStateFields;
(function(StreamBaseStateFields) {
    StreamBaseStateFields[StreamBaseStateFields["kReadBytesOrError"] = 0] = "kReadBytesOrError";
    StreamBaseStateFields[StreamBaseStateFields["kArrayBufferOffset"] = 1] = "kArrayBufferOffset";
    StreamBaseStateFields[StreamBaseStateFields["kBytesWritten"] = 2] = "kBytesWritten";
    StreamBaseStateFields[StreamBaseStateFields["kLastWriteWasAsync"] = 3] = "kLastWriteWasAsync";
    StreamBaseStateFields[StreamBaseStateFields["kNumStreamBaseStateFields"] = 4] = "kNumStreamBaseStateFields";
})(StreamBaseStateFields || (StreamBaseStateFields = {}));
export const kReadBytesOrError = StreamBaseStateFields.kReadBytesOrError;
export const kArrayBufferOffset = StreamBaseStateFields.kArrayBufferOffset;
export const kBytesWritten = StreamBaseStateFields.kBytesWritten;
export const kLastWriteWasAsync = StreamBaseStateFields.kLastWriteWasAsync;
export const kNumStreamBaseStateFields = StreamBaseStateFields.kNumStreamBaseStateFields;
export const streamBaseState = new Uint8Array(5);
// This is Deno, it always will be async.
streamBaseState[kLastWriteWasAsync] = 1;
export class WriteWrap extends AsyncWrap {
    handle;
    oncomplete;
    async;
    bytes;
    buffer;
    callback;
    _chunks;
    constructor(){
        super(providerType.WRITEWRAP);
    }
}
export class ShutdownWrap extends AsyncWrap {
    handle;
    oncomplete;
    callback;
    constructor(){
        super(providerType.SHUTDOWNWRAP);
    }
}
export const kStreamBaseField = Symbol("kStreamBaseField");
const SUGGESTED_SIZE = 64 * 1024;
export class LibuvStreamWrap extends HandleWrap {
    [kStreamBaseField];
    reading;
    #reading = false;
    destroyed = false;
    writeQueueSize = 0;
    bytesRead = 0;
    bytesWritten = 0;
    onread;
    constructor(provider, stream){
        super(provider);
        this.#attachToObject(stream);
    }
    /**
   * Start the reading of the stream.
   * @return An error status code.
   */ readStart() {
        if (!this.#reading) {
            this.#reading = true;
            this.#read();
        }
        return 0;
    }
    /**
   * Stop the reading of the stream.
   * @return An error status code.
   */ readStop() {
        this.#reading = false;
        return 0;
    }
    /**
   * Shutdown the stream.
   * @param req A shutdown request wrapper.
   * @return An error status code.
   */ shutdown(req) {
        const status = this._onClose();
        try {
            req.oncomplete(status);
        } catch  {
        // swallow callback error.
        }
        return 0;
    }
    /**
   * @param userBuf
   * @return An error status code.
   */ useUserBuffer(_userBuf) {
        // TODO(cmorten)
        notImplemented("LibuvStreamWrap.prototype.useUserBuffer");
    }
    /**
   * Write a buffer to the stream.
   * @param req A write request wrapper.
   * @param data The Uint8Array buffer to write to the stream.
   * @return An error status code.
   */ writeBuffer(req, data) {
        this.#write(req, data);
        return 0;
    }
    /**
   * Write multiple chunks at once.
   * @param req A write request wrapper.
   * @param chunks
   * @param allBuffers
   * @return An error status code.
   */ writev(req, chunks, allBuffers) {
        const count = allBuffers ? chunks.length : chunks.length >> 1;
        const buffers = new Array(count);
        if (!allBuffers) {
            for(let i = 0; i < count; i++){
                const chunk = chunks[i * 2];
                if (Buffer.isBuffer(chunk)) {
                    buffers[i] = chunk;
                }
                // String chunk
                const encoding = chunks[i * 2 + 1];
                buffers[i] = Buffer.from(chunk, encoding);
            }
        } else {
            for(let i1 = 0; i1 < count; i1++){
                buffers[i1] = chunks[i1];
            }
        }
        return this.writeBuffer(req, Buffer.concat(buffers));
    }
    /**
   * Write an ASCII string to the stream.
   * @return An error status code.
   */ writeAsciiString(req, data) {
        const buffer = new TextEncoder().encode(data);
        return this.writeBuffer(req, buffer);
    }
    /**
   * Write an UTF8 string to the stream.
   * @return An error status code.
   */ writeUtf8String(req, data) {
        const buffer = new TextEncoder().encode(data);
        return this.writeBuffer(req, buffer);
    }
    /**
   * Write an UCS2 string to the stream.
   * @return An error status code.
   */ writeUcs2String(_req, _data) {
        notImplemented("LibuvStreamWrap.prototype.writeUcs2String");
    }
    /**
   * Write an LATIN1 string to the stream.
   * @return An error status code.
   */ writeLatin1String(req, data) {
        const buffer = Buffer.from(data, "latin1");
        return this.writeBuffer(req, buffer);
    }
    _onClose() {
        let status = 0;
        this.#reading = false;
        try {
            this[kStreamBaseField]?.close();
        } catch  {
            status = codeMap.get("ENOTCONN");
        }
        return status;
    }
    /**
   * Attaches the class to the underlying stream.
   * @param stream The stream to attach to.
   */  #attachToObject(stream) {
        this[kStreamBaseField] = stream;
    }
    /** Internal method for reading from the attached stream. */ async #read() {
        let buf = new Uint8Array(SUGGESTED_SIZE);
        let nread;
        try {
            nread = await this[kStreamBaseField].read(buf);
        } catch (e) {
            if (e instanceof Deno.errors.Interrupted || e instanceof Deno.errors.BadResource) {
                nread = codeMap.get("EOF");
            } else if (e instanceof Deno.errors.ConnectionReset || e instanceof Deno.errors.ConnectionAborted) {
                nread = codeMap.get("ECONNRESET");
            } else {
                nread = codeMap.get("UNKNOWN");
            }
            buf = new Uint8Array(0);
        }
        nread ??= codeMap.get("EOF");
        streamBaseState[kReadBytesOrError] = nread;
        if (nread > 0) {
            this.bytesRead += nread;
        }
        buf = buf.slice(0, nread);
        streamBaseState[kArrayBufferOffset] = 0;
        try {
            this.onread(buf, nread);
        } catch  {
        // swallow callback errors.
        }
        if (nread >= 0 && this.#reading) {
            this.#read();
        }
    }
    /**
   * Internal method for writing to the attached stream.
   * @param req A write request wrapper.
   * @param data The Uint8Array buffer to write to the stream.
   */ async #write(req, data) {
        const { byteLength  } = data;
        try {
            await writeAll(this[kStreamBaseField], data);
        } catch (e1) {
            let status;
            // TODO(cmorten): map err to status codes
            if (e1 instanceof Deno.errors.BadResource || e1 instanceof Deno.errors.BrokenPipe) {
                status = codeMap.get("EBADF");
            } else {
                status = codeMap.get("UNKNOWN");
            }
            try {
                req.oncomplete(status);
            } catch  {
            // swallow callback errors.
            }
            return;
        }
        streamBaseState[kBytesWritten] = byteLength;
        this.bytesWritten += byteLength;
        try {
            req.oncomplete(0);
        } catch  {
        // swallow callback errors.
        }
        return;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImh0dHBzOi8vZGVuby5sYW5kL3N0ZEAwLjE0Ny4wL25vZGUvaW50ZXJuYWxfYmluZGluZy9zdHJlYW1fd3JhcC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxOC0yMDIyIHRoZSBEZW5vIGF1dGhvcnMuIEFsbCByaWdodHMgcmVzZXJ2ZWQuIE1JVCBsaWNlbnNlLlxuLy8gQ29weXJpZ2h0IEpveWVudCwgSW5jLiBhbmQgb3RoZXIgTm9kZSBjb250cmlidXRvcnMuXG4vL1xuLy8gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGFcbi8vIGNvcHkgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGVcbi8vIFwiU29mdHdhcmVcIiksIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZ1xuLy8gd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMgdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLFxuLy8gZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdFxuLy8gcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlXG4vLyBmb2xsb3dpbmcgY29uZGl0aW9uczpcbi8vXG4vLyBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZFxuLy8gaW4gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG4vL1xuLy8gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTU1xuLy8gT1IgSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRlxuLy8gTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTlxuLy8gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sXG4vLyBEQU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1Jcbi8vIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEVcbi8vIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEUgU09GVFdBUkUuXG5cbi8vIFRoaXMgbW9kdWxlIHBvcnRzOlxuLy8gLSBodHRwczovL2dpdGh1Yi5jb20vbm9kZWpzL25vZGUvYmxvYi9tYXN0ZXIvc3JjL3N0cmVhbV9iYXNlLWlubC5oXG4vLyAtIGh0dHBzOi8vZ2l0aHViLmNvbS9ub2RlanMvbm9kZS9ibG9iL21hc3Rlci9zcmMvc3RyZWFtX2Jhc2UuaFxuLy8gLSBodHRwczovL2dpdGh1Yi5jb20vbm9kZWpzL25vZGUvYmxvYi9tYXN0ZXIvc3JjL3N0cmVhbV9iYXNlLmNjXG4vLyAtIGh0dHBzOi8vZ2l0aHViLmNvbS9ub2RlanMvbm9kZS9ibG9iL21hc3Rlci9zcmMvc3RyZWFtX3dyYXAuaFxuLy8gLSBodHRwczovL2dpdGh1Yi5jb20vbm9kZWpzL25vZGUvYmxvYi9tYXN0ZXIvc3JjL3N0cmVhbV93cmFwLmNjXG5cbmltcG9ydCB7IEJ1ZmZlciB9IGZyb20gXCIuLi9idWZmZXIudHNcIjtcbmltcG9ydCB7IG5vdEltcGxlbWVudGVkIH0gZnJvbSBcIi4uL191dGlscy50c1wiO1xuaW1wb3J0IHsgSGFuZGxlV3JhcCB9IGZyb20gXCIuL2hhbmRsZV93cmFwLnRzXCI7XG5pbXBvcnQgeyBBc3luY1dyYXAsIHByb3ZpZGVyVHlwZSB9IGZyb20gXCIuL2FzeW5jX3dyYXAudHNcIjtcbmltcG9ydCB7IGNvZGVNYXAgfSBmcm9tIFwiLi91di50c1wiO1xuaW1wb3J0IHsgd3JpdGVBbGwgfSBmcm9tIFwiLi4vLi4vc3RyZWFtcy9jb252ZXJzaW9uLnRzXCI7XG5cbmVudW0gU3RyZWFtQmFzZVN0YXRlRmllbGRzIHtcbiAga1JlYWRCeXRlc09yRXJyb3IsXG4gIGtBcnJheUJ1ZmZlck9mZnNldCxcbiAga0J5dGVzV3JpdHRlbixcbiAga0xhc3RXcml0ZVdhc0FzeW5jLFxuICBrTnVtU3RyZWFtQmFzZVN0YXRlRmllbGRzLFxufVxuXG5leHBvcnQgY29uc3Qga1JlYWRCeXRlc09yRXJyb3IgPSBTdHJlYW1CYXNlU3RhdGVGaWVsZHMua1JlYWRCeXRlc09yRXJyb3I7XG5leHBvcnQgY29uc3Qga0FycmF5QnVmZmVyT2Zmc2V0ID0gU3RyZWFtQmFzZVN0YXRlRmllbGRzLmtBcnJheUJ1ZmZlck9mZnNldDtcbmV4cG9ydCBjb25zdCBrQnl0ZXNXcml0dGVuID0gU3RyZWFtQmFzZVN0YXRlRmllbGRzLmtCeXRlc1dyaXR0ZW47XG5leHBvcnQgY29uc3Qga0xhc3RXcml0ZVdhc0FzeW5jID0gU3RyZWFtQmFzZVN0YXRlRmllbGRzLmtMYXN0V3JpdGVXYXNBc3luYztcbmV4cG9ydCBjb25zdCBrTnVtU3RyZWFtQmFzZVN0YXRlRmllbGRzID1cbiAgU3RyZWFtQmFzZVN0YXRlRmllbGRzLmtOdW1TdHJlYW1CYXNlU3RhdGVGaWVsZHM7XG5cbmV4cG9ydCBjb25zdCBzdHJlYW1CYXNlU3RhdGUgPSBuZXcgVWludDhBcnJheSg1KTtcblxuLy8gVGhpcyBpcyBEZW5vLCBpdCBhbHdheXMgd2lsbCBiZSBhc3luYy5cbnN0cmVhbUJhc2VTdGF0ZVtrTGFzdFdyaXRlV2FzQXN5bmNdID0gMTtcblxuZXhwb3J0IGNsYXNzIFdyaXRlV3JhcDxIIGV4dGVuZHMgSGFuZGxlV3JhcD4gZXh0ZW5kcyBBc3luY1dyYXAge1xuICBoYW5kbGUhOiBIO1xuICBvbmNvbXBsZXRlITogKHN0YXR1czogbnVtYmVyKSA9PiB2b2lkO1xuICBhc3luYyE6IGJvb2xlYW47XG4gIGJ5dGVzITogbnVtYmVyO1xuICBidWZmZXIhOiB1bmtub3duO1xuICBjYWxsYmFjayE6IHVua25vd247XG4gIF9jaHVua3MhOiB1bmtub3duW107XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIocHJvdmlkZXJUeXBlLldSSVRFV1JBUCk7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIFNodXRkb3duV3JhcDxIIGV4dGVuZHMgSGFuZGxlV3JhcD4gZXh0ZW5kcyBBc3luY1dyYXAge1xuICBoYW5kbGUhOiBIO1xuICBvbmNvbXBsZXRlITogKHN0YXR1czogbnVtYmVyKSA9PiB2b2lkO1xuICBjYWxsYmFjayE6ICgpID0+IHZvaWQ7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIocHJvdmlkZXJUeXBlLlNIVVRET1dOV1JBUCk7XG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IGtTdHJlYW1CYXNlRmllbGQgPSBTeW1ib2woXCJrU3RyZWFtQmFzZUZpZWxkXCIpO1xuXG5jb25zdCBTVUdHRVNURURfU0laRSA9IDY0ICogMTAyNDtcblxuZXhwb3J0IGNsYXNzIExpYnV2U3RyZWFtV3JhcCBleHRlbmRzIEhhbmRsZVdyYXAge1xuICBba1N0cmVhbUJhc2VGaWVsZF0/OiBEZW5vLlJlYWRlciAmIERlbm8uV3JpdGVyICYgRGVuby5DbG9zZXI7XG5cbiAgcmVhZGluZyE6IGJvb2xlYW47XG4gICNyZWFkaW5nID0gZmFsc2U7XG4gIGRlc3Ryb3llZCA9IGZhbHNlO1xuICB3cml0ZVF1ZXVlU2l6ZSA9IDA7XG4gIGJ5dGVzUmVhZCA9IDA7XG4gIGJ5dGVzV3JpdHRlbiA9IDA7XG5cbiAgb25yZWFkITogKF9hcnJheUJ1ZmZlcjogVWludDhBcnJheSwgX25yZWFkOiBudW1iZXIpID0+IFVpbnQ4QXJyYXkgfCB1bmRlZmluZWQ7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJvdmlkZXI6IHByb3ZpZGVyVHlwZSxcbiAgICBzdHJlYW0/OiBEZW5vLlJlYWRlciAmIERlbm8uV3JpdGVyICYgRGVuby5DbG9zZXIsXG4gICkge1xuICAgIHN1cGVyKHByb3ZpZGVyKTtcbiAgICB0aGlzLiNhdHRhY2hUb09iamVjdChzdHJlYW0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFN0YXJ0IHRoZSByZWFkaW5nIG9mIHRoZSBzdHJlYW0uXG4gICAqIEByZXR1cm4gQW4gZXJyb3Igc3RhdHVzIGNvZGUuXG4gICAqL1xuICByZWFkU3RhcnQoKTogbnVtYmVyIHtcbiAgICBpZiAoIXRoaXMuI3JlYWRpbmcpIHtcbiAgICAgIHRoaXMuI3JlYWRpbmcgPSB0cnVlO1xuICAgICAgdGhpcy4jcmVhZCgpO1xuICAgIH1cblxuICAgIHJldHVybiAwO1xuICB9XG5cbiAgLyoqXG4gICAqIFN0b3AgdGhlIHJlYWRpbmcgb2YgdGhlIHN0cmVhbS5cbiAgICogQHJldHVybiBBbiBlcnJvciBzdGF0dXMgY29kZS5cbiAgICovXG4gIHJlYWRTdG9wKCk6IG51bWJlciB7XG4gICAgdGhpcy4jcmVhZGluZyA9IGZhbHNlO1xuXG4gICAgcmV0dXJuIDA7XG4gIH1cblxuICAvKipcbiAgICogU2h1dGRvd24gdGhlIHN0cmVhbS5cbiAgICogQHBhcmFtIHJlcSBBIHNodXRkb3duIHJlcXVlc3Qgd3JhcHBlci5cbiAgICogQHJldHVybiBBbiBlcnJvciBzdGF0dXMgY29kZS5cbiAgICovXG4gIHNodXRkb3duKHJlcTogU2h1dGRvd25XcmFwPExpYnV2U3RyZWFtV3JhcD4pOiBudW1iZXIge1xuICAgIGNvbnN0IHN0YXR1cyA9IHRoaXMuX29uQ2xvc2UoKTtcblxuICAgIHRyeSB7XG4gICAgICByZXEub25jb21wbGV0ZShzdGF0dXMpO1xuICAgIH0gY2F0Y2gge1xuICAgICAgLy8gc3dhbGxvdyBjYWxsYmFjayBlcnJvci5cbiAgICB9XG5cbiAgICByZXR1cm4gMDtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcGFyYW0gdXNlckJ1ZlxuICAgKiBAcmV0dXJuIEFuIGVycm9yIHN0YXR1cyBjb2RlLlxuICAgKi9cbiAgdXNlVXNlckJ1ZmZlcihfdXNlckJ1ZjogdW5rbm93bik6IG51bWJlciB7XG4gICAgLy8gVE9ETyhjbW9ydGVuKVxuICAgIG5vdEltcGxlbWVudGVkKFwiTGlidXZTdHJlYW1XcmFwLnByb3RvdHlwZS51c2VVc2VyQnVmZmVyXCIpO1xuICB9XG5cbiAgLyoqXG4gICAqIFdyaXRlIGEgYnVmZmVyIHRvIHRoZSBzdHJlYW0uXG4gICAqIEBwYXJhbSByZXEgQSB3cml0ZSByZXF1ZXN0IHdyYXBwZXIuXG4gICAqIEBwYXJhbSBkYXRhIFRoZSBVaW50OEFycmF5IGJ1ZmZlciB0byB3cml0ZSB0byB0aGUgc3RyZWFtLlxuICAgKiBAcmV0dXJuIEFuIGVycm9yIHN0YXR1cyBjb2RlLlxuICAgKi9cbiAgd3JpdGVCdWZmZXIocmVxOiBXcml0ZVdyYXA8TGlidXZTdHJlYW1XcmFwPiwgZGF0YTogVWludDhBcnJheSk6IG51bWJlciB7XG4gICAgdGhpcy4jd3JpdGUocmVxLCBkYXRhKTtcblxuICAgIHJldHVybiAwO1xuICB9XG5cbiAgLyoqXG4gICAqIFdyaXRlIG11bHRpcGxlIGNodW5rcyBhdCBvbmNlLlxuICAgKiBAcGFyYW0gcmVxIEEgd3JpdGUgcmVxdWVzdCB3cmFwcGVyLlxuICAgKiBAcGFyYW0gY2h1bmtzXG4gICAqIEBwYXJhbSBhbGxCdWZmZXJzXG4gICAqIEByZXR1cm4gQW4gZXJyb3Igc3RhdHVzIGNvZGUuXG4gICAqL1xuICB3cml0ZXYoXG4gICAgcmVxOiBXcml0ZVdyYXA8TGlidXZTdHJlYW1XcmFwPixcbiAgICBjaHVua3M6IEJ1ZmZlcltdIHwgKHN0cmluZyB8IEJ1ZmZlcilbXSxcbiAgICBhbGxCdWZmZXJzOiBib29sZWFuLFxuICApOiBudW1iZXIge1xuICAgIGNvbnN0IGNvdW50ID0gYWxsQnVmZmVycyA/IGNodW5rcy5sZW5ndGggOiBjaHVua3MubGVuZ3RoID4+IDE7XG4gICAgY29uc3QgYnVmZmVyczogQnVmZmVyW10gPSBuZXcgQXJyYXkoY291bnQpO1xuXG4gICAgaWYgKCFhbGxCdWZmZXJzKSB7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHtcbiAgICAgICAgY29uc3QgY2h1bmsgPSBjaHVua3NbaSAqIDJdO1xuXG4gICAgICAgIGlmIChCdWZmZXIuaXNCdWZmZXIoY2h1bmspKSB7XG4gICAgICAgICAgYnVmZmVyc1tpXSA9IGNodW5rO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gU3RyaW5nIGNodW5rXG4gICAgICAgIGNvbnN0IGVuY29kaW5nOiBzdHJpbmcgPSBjaHVua3NbaSAqIDIgKyAxXSBhcyBzdHJpbmc7XG4gICAgICAgIGJ1ZmZlcnNbaV0gPSBCdWZmZXIuZnJvbShjaHVuayBhcyBzdHJpbmcsIGVuY29kaW5nKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7XG4gICAgICAgIGJ1ZmZlcnNbaV0gPSBjaHVua3NbaV0gYXMgQnVmZmVyO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0aGlzLndyaXRlQnVmZmVyKHJlcSwgQnVmZmVyLmNvbmNhdChidWZmZXJzKSk7XG4gIH1cblxuICAvKipcbiAgICogV3JpdGUgYW4gQVNDSUkgc3RyaW5nIHRvIHRoZSBzdHJlYW0uXG4gICAqIEByZXR1cm4gQW4gZXJyb3Igc3RhdHVzIGNvZGUuXG4gICAqL1xuICB3cml0ZUFzY2lpU3RyaW5nKHJlcTogV3JpdGVXcmFwPExpYnV2U3RyZWFtV3JhcD4sIGRhdGE6IHN0cmluZyk6IG51bWJlciB7XG4gICAgY29uc3QgYnVmZmVyID0gbmV3IFRleHRFbmNvZGVyKCkuZW5jb2RlKGRhdGEpO1xuXG4gICAgcmV0dXJuIHRoaXMud3JpdGVCdWZmZXIocmVxLCBidWZmZXIpO1xuICB9XG5cbiAgLyoqXG4gICAqIFdyaXRlIGFuIFVURjggc3RyaW5nIHRvIHRoZSBzdHJlYW0uXG4gICAqIEByZXR1cm4gQW4gZXJyb3Igc3RhdHVzIGNvZGUuXG4gICAqL1xuICB3cml0ZVV0ZjhTdHJpbmcocmVxOiBXcml0ZVdyYXA8TGlidXZTdHJlYW1XcmFwPiwgZGF0YTogc3RyaW5nKTogbnVtYmVyIHtcbiAgICBjb25zdCBidWZmZXIgPSBuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUoZGF0YSk7XG5cbiAgICByZXR1cm4gdGhpcy53cml0ZUJ1ZmZlcihyZXEsIGJ1ZmZlcik7XG4gIH1cblxuICAvKipcbiAgICogV3JpdGUgYW4gVUNTMiBzdHJpbmcgdG8gdGhlIHN0cmVhbS5cbiAgICogQHJldHVybiBBbiBlcnJvciBzdGF0dXMgY29kZS5cbiAgICovXG4gIHdyaXRlVWNzMlN0cmluZyhfcmVxOiBXcml0ZVdyYXA8TGlidXZTdHJlYW1XcmFwPiwgX2RhdGE6IHN0cmluZyk6IG51bWJlciB7XG4gICAgbm90SW1wbGVtZW50ZWQoXCJMaWJ1dlN0cmVhbVdyYXAucHJvdG90eXBlLndyaXRlVWNzMlN0cmluZ1wiKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBXcml0ZSBhbiBMQVRJTjEgc3RyaW5nIHRvIHRoZSBzdHJlYW0uXG4gICAqIEByZXR1cm4gQW4gZXJyb3Igc3RhdHVzIGNvZGUuXG4gICAqL1xuICB3cml0ZUxhdGluMVN0cmluZyhyZXE6IFdyaXRlV3JhcDxMaWJ1dlN0cmVhbVdyYXA+LCBkYXRhOiBzdHJpbmcpOiBudW1iZXIge1xuICAgIGNvbnN0IGJ1ZmZlciA9IEJ1ZmZlci5mcm9tKGRhdGEsIFwibGF0aW4xXCIpO1xuICAgIHJldHVybiB0aGlzLndyaXRlQnVmZmVyKHJlcSwgYnVmZmVyKTtcbiAgfVxuXG4gIG92ZXJyaWRlIF9vbkNsb3NlKCk6IG51bWJlciB7XG4gICAgbGV0IHN0YXR1cyA9IDA7XG4gICAgdGhpcy4jcmVhZGluZyA9IGZhbHNlO1xuXG4gICAgdHJ5IHtcbiAgICAgIHRoaXNba1N0cmVhbUJhc2VGaWVsZF0/LmNsb3NlKCk7XG4gICAgfSBjYXRjaCB7XG4gICAgICBzdGF0dXMgPSBjb2RlTWFwLmdldChcIkVOT1RDT05OXCIpITtcbiAgICB9XG5cbiAgICByZXR1cm4gc3RhdHVzO1xuICB9XG5cbiAgLyoqXG4gICAqIEF0dGFjaGVzIHRoZSBjbGFzcyB0byB0aGUgdW5kZXJseWluZyBzdHJlYW0uXG4gICAqIEBwYXJhbSBzdHJlYW0gVGhlIHN0cmVhbSB0byBhdHRhY2ggdG8uXG4gICAqL1xuICAjYXR0YWNoVG9PYmplY3Qoc3RyZWFtPzogRGVuby5SZWFkZXIgJiBEZW5vLldyaXRlciAmIERlbm8uQ2xvc2VyKTogdm9pZCB7XG4gICAgdGhpc1trU3RyZWFtQmFzZUZpZWxkXSA9IHN0cmVhbTtcbiAgfVxuXG4gIC8qKiBJbnRlcm5hbCBtZXRob2QgZm9yIHJlYWRpbmcgZnJvbSB0aGUgYXR0YWNoZWQgc3RyZWFtLiAqL1xuICBhc3luYyAjcmVhZCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBsZXQgYnVmID0gbmV3IFVpbnQ4QXJyYXkoU1VHR0VTVEVEX1NJWkUpO1xuXG4gICAgbGV0IG5yZWFkOiBudW1iZXIgfCBudWxsO1xuICAgIHRyeSB7XG4gICAgICBucmVhZCA9IGF3YWl0IHRoaXNba1N0cmVhbUJhc2VGaWVsZF0hLnJlYWQoYnVmKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBpZiAoXG4gICAgICAgIGUgaW5zdGFuY2VvZiBEZW5vLmVycm9ycy5JbnRlcnJ1cHRlZCB8fFxuICAgICAgICBlIGluc3RhbmNlb2YgRGVuby5lcnJvcnMuQmFkUmVzb3VyY2VcbiAgICAgICkge1xuICAgICAgICBucmVhZCA9IGNvZGVNYXAuZ2V0KFwiRU9GXCIpITtcbiAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgIGUgaW5zdGFuY2VvZiBEZW5vLmVycm9ycy5Db25uZWN0aW9uUmVzZXQgfHxcbiAgICAgICAgZSBpbnN0YW5jZW9mIERlbm8uZXJyb3JzLkNvbm5lY3Rpb25BYm9ydGVkXG4gICAgICApIHtcbiAgICAgICAgbnJlYWQgPSBjb2RlTWFwLmdldChcIkVDT05OUkVTRVRcIikhO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbnJlYWQgPSBjb2RlTWFwLmdldChcIlVOS05PV05cIikhO1xuICAgICAgfVxuXG4gICAgICBidWYgPSBuZXcgVWludDhBcnJheSgwKTtcbiAgICB9XG5cbiAgICBucmVhZCA/Pz0gY29kZU1hcC5nZXQoXCJFT0ZcIikhO1xuXG4gICAgc3RyZWFtQmFzZVN0YXRlW2tSZWFkQnl0ZXNPckVycm9yXSA9IG5yZWFkO1xuXG4gICAgaWYgKG5yZWFkID4gMCkge1xuICAgICAgdGhpcy5ieXRlc1JlYWQgKz0gbnJlYWQ7XG4gICAgfVxuXG4gICAgYnVmID0gYnVmLnNsaWNlKDAsIG5yZWFkKTtcblxuICAgIHN0cmVhbUJhc2VTdGF0ZVtrQXJyYXlCdWZmZXJPZmZzZXRdID0gMDtcblxuICAgIHRyeSB7XG4gICAgICB0aGlzLm9ucmVhZCEoYnVmLCBucmVhZCk7XG4gICAgfSBjYXRjaCB7XG4gICAgICAvLyBzd2FsbG93IGNhbGxiYWNrIGVycm9ycy5cbiAgICB9XG5cbiAgICBpZiAobnJlYWQgPj0gMCAmJiB0aGlzLiNyZWFkaW5nKSB7XG4gICAgICB0aGlzLiNyZWFkKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEludGVybmFsIG1ldGhvZCBmb3Igd3JpdGluZyB0byB0aGUgYXR0YWNoZWQgc3RyZWFtLlxuICAgKiBAcGFyYW0gcmVxIEEgd3JpdGUgcmVxdWVzdCB3cmFwcGVyLlxuICAgKiBAcGFyYW0gZGF0YSBUaGUgVWludDhBcnJheSBidWZmZXIgdG8gd3JpdGUgdG8gdGhlIHN0cmVhbS5cbiAgICovXG4gIGFzeW5jICN3cml0ZShyZXE6IFdyaXRlV3JhcDxMaWJ1dlN0cmVhbVdyYXA+LCBkYXRhOiBVaW50OEFycmF5KSB7XG4gICAgY29uc3QgeyBieXRlTGVuZ3RoIH0gPSBkYXRhO1xuXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHdyaXRlQWxsKHRoaXNba1N0cmVhbUJhc2VGaWVsZF0hLCBkYXRhKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBsZXQgc3RhdHVzOiBudW1iZXI7XG5cbiAgICAgIC8vIFRPRE8oY21vcnRlbik6IG1hcCBlcnIgdG8gc3RhdHVzIGNvZGVzXG4gICAgICBpZiAoXG4gICAgICAgIGUgaW5zdGFuY2VvZiBEZW5vLmVycm9ycy5CYWRSZXNvdXJjZSB8fFxuICAgICAgICBlIGluc3RhbmNlb2YgRGVuby5lcnJvcnMuQnJva2VuUGlwZVxuICAgICAgKSB7XG4gICAgICAgIHN0YXR1cyA9IGNvZGVNYXAuZ2V0KFwiRUJBREZcIikhO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc3RhdHVzID0gY29kZU1hcC5nZXQoXCJVTktOT1dOXCIpITtcbiAgICAgIH1cblxuICAgICAgdHJ5IHtcbiAgICAgICAgcmVxLm9uY29tcGxldGUoc3RhdHVzKTtcbiAgICAgIH0gY2F0Y2gge1xuICAgICAgICAvLyBzd2FsbG93IGNhbGxiYWNrIGVycm9ycy5cbiAgICAgIH1cblxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHN0cmVhbUJhc2VTdGF0ZVtrQnl0ZXNXcml0dGVuXSA9IGJ5dGVMZW5ndGg7XG4gICAgdGhpcy5ieXRlc1dyaXR0ZW4gKz0gYnl0ZUxlbmd0aDtcblxuICAgIHRyeSB7XG4gICAgICByZXEub25jb21wbGV0ZSgwKTtcbiAgICB9IGNhdGNoIHtcbiAgICAgIC8vIHN3YWxsb3cgY2FsbGJhY2sgZXJyb3JzLlxuICAgIH1cblxuICAgIHJldHVybjtcbiAgfVxufVxuIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLDBFQUEwRTtBQUMxRSxzREFBc0Q7QUFDdEQsRUFBRTtBQUNGLDBFQUEwRTtBQUMxRSxnRUFBZ0U7QUFDaEUsc0VBQXNFO0FBQ3RFLHNFQUFzRTtBQUN0RSw0RUFBNEU7QUFDNUUscUVBQXFFO0FBQ3JFLHdCQUF3QjtBQUN4QixFQUFFO0FBQ0YsMEVBQTBFO0FBQzFFLHlEQUF5RDtBQUN6RCxFQUFFO0FBQ0YsMEVBQTBFO0FBQzFFLDZEQUE2RDtBQUM3RCw0RUFBNEU7QUFDNUUsMkVBQTJFO0FBQzNFLHdFQUF3RTtBQUN4RSw0RUFBNEU7QUFDNUUseUNBQXlDO0FBRXpDLHFCQUFxQjtBQUNyQixxRUFBcUU7QUFDckUsaUVBQWlFO0FBQ2pFLGtFQUFrRTtBQUNsRSxpRUFBaUU7QUFDakUsa0VBQWtFO0FBRWxFLFNBQVMsTUFBTSxRQUFRLGNBQWMsQ0FBQztBQUN0QyxTQUFTLGNBQWMsUUFBUSxjQUFjLENBQUM7QUFDOUMsU0FBUyxVQUFVLFFBQVEsa0JBQWtCLENBQUM7QUFDOUMsU0FBUyxTQUFTLEVBQUUsWUFBWSxRQUFRLGlCQUFpQixDQUFDO0FBQzFELFNBQVMsT0FBTyxRQUFRLFNBQVMsQ0FBQztBQUNsQyxTQUFTLFFBQVEsUUFBUSw2QkFBNkIsQ0FBQztJQUV2RCxxQkFNQztVQU5JLHFCQUFxQjtJQUFyQixxQkFBcUIsQ0FBckIscUJBQXFCLENBQ3hCLG1CQUFpQixJQUFqQixDQUFpQixJQUFqQixtQkFBaUI7SUFEZCxxQkFBcUIsQ0FBckIscUJBQXFCLENBRXhCLG9CQUFrQixJQUFsQixDQUFrQixJQUFsQixvQkFBa0I7SUFGZixxQkFBcUIsQ0FBckIscUJBQXFCLENBR3hCLGVBQWEsSUFBYixDQUFhLElBQWIsZUFBYTtJQUhWLHFCQUFxQixDQUFyQixxQkFBcUIsQ0FJeEIsb0JBQWtCLElBQWxCLENBQWtCLElBQWxCLG9CQUFrQjtJQUpmLHFCQUFxQixDQUFyQixxQkFBcUIsQ0FLeEIsMkJBQXlCLElBQXpCLENBQXlCLElBQXpCLDJCQUF5QjtHQUx0QixxQkFBcUIsS0FBckIscUJBQXFCO0FBUTFCLE9BQU8sTUFBTSxpQkFBaUIsR0FBRyxxQkFBcUIsQ0FBQyxpQkFBaUIsQ0FBQztBQUN6RSxPQUFPLE1BQU0sa0JBQWtCLEdBQUcscUJBQXFCLENBQUMsa0JBQWtCLENBQUM7QUFDM0UsT0FBTyxNQUFNLGFBQWEsR0FBRyxxQkFBcUIsQ0FBQyxhQUFhLENBQUM7QUFDakUsT0FBTyxNQUFNLGtCQUFrQixHQUFHLHFCQUFxQixDQUFDLGtCQUFrQixDQUFDO0FBQzNFLE9BQU8sTUFBTSx5QkFBeUIsR0FDcEMscUJBQXFCLENBQUMseUJBQXlCLENBQUM7QUFFbEQsT0FBTyxNQUFNLGVBQWUsR0FBRyxJQUFJLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUVqRCx5Q0FBeUM7QUFDekMsZUFBZSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBRXhDLE9BQU8sTUFBTSxTQUFTLFNBQStCLFNBQVM7SUFDNUQsTUFBTSxDQUFLO0lBQ1gsVUFBVSxDQUE0QjtJQUN0QyxLQUFLLENBQVc7SUFDaEIsS0FBSyxDQUFVO0lBQ2YsTUFBTSxDQUFXO0lBQ2pCLFFBQVEsQ0FBVztJQUNuQixPQUFPLENBQWE7SUFFcEIsYUFBYztRQUNaLEtBQUssQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDLENBQUM7S0FDL0I7Q0FDRjtBQUVELE9BQU8sTUFBTSxZQUFZLFNBQStCLFNBQVM7SUFDL0QsTUFBTSxDQUFLO0lBQ1gsVUFBVSxDQUE0QjtJQUN0QyxRQUFRLENBQWM7SUFFdEIsYUFBYztRQUNaLEtBQUssQ0FBQyxZQUFZLENBQUMsWUFBWSxDQUFDLENBQUM7S0FDbEM7Q0FDRjtBQUVELE9BQU8sTUFBTSxnQkFBZ0IsR0FBRyxNQUFNLENBQUMsa0JBQWtCLENBQUMsQ0FBQztBQUUzRCxNQUFNLGNBQWMsR0FBRyxFQUFFLEdBQUcsSUFBSSxBQUFDO0FBRWpDLE9BQU8sTUFBTSxlQUFlLFNBQVMsVUFBVTtJQUM3QyxDQUFDLGdCQUFnQixDQUFDLENBQTJDO0lBRTdELE9BQU8sQ0FBVztJQUNsQixDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUM7SUFDakIsU0FBUyxHQUFHLEtBQUssQ0FBQztJQUNsQixjQUFjLEdBQUcsQ0FBQyxDQUFDO0lBQ25CLFNBQVMsR0FBRyxDQUFDLENBQUM7SUFDZCxZQUFZLEdBQUcsQ0FBQyxDQUFDO0lBRWpCLE1BQU0sQ0FBd0U7SUFFOUUsWUFDRSxRQUFzQixFQUN0QixNQUFnRCxDQUNoRDtRQUNBLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNoQixJQUFJLENBQUMsQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFDLENBQUM7S0FDOUI7SUFFRDs7O0tBR0csQ0FDSCxTQUFTLEdBQVc7UUFDbEIsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sRUFBRTtZQUNsQixJQUFJLENBQUMsQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDO1lBQ3JCLElBQUksQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO1NBQ2Q7UUFFRCxPQUFPLENBQUMsQ0FBQztLQUNWO0lBRUQ7OztLQUdHLENBQ0gsUUFBUSxHQUFXO1FBQ2pCLElBQUksQ0FBQyxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUM7UUFFdEIsT0FBTyxDQUFDLENBQUM7S0FDVjtJQUVEOzs7O0tBSUcsQ0FDSCxRQUFRLENBQUMsR0FBa0MsRUFBVTtRQUNuRCxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsUUFBUSxFQUFFLEFBQUM7UUFFL0IsSUFBSTtZQUNGLEdBQUcsQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUM7U0FDeEIsQ0FBQyxPQUFNO1FBQ04sMEJBQTBCO1NBQzNCO1FBRUQsT0FBTyxDQUFDLENBQUM7S0FDVjtJQUVEOzs7S0FHRyxDQUNILGFBQWEsQ0FBQyxRQUFpQixFQUFVO1FBQ3ZDLGdCQUFnQjtRQUNoQixjQUFjLENBQUMseUNBQXlDLENBQUMsQ0FBQztLQUMzRDtJQUVEOzs7OztLQUtHLENBQ0gsV0FBVyxDQUFDLEdBQStCLEVBQUUsSUFBZ0IsRUFBVTtRQUNyRSxJQUFJLENBQUMsQ0FBQyxLQUFLLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxDQUFDO1FBRXZCLE9BQU8sQ0FBQyxDQUFDO0tBQ1Y7SUFFRDs7Ozs7O0tBTUcsQ0FDSCxNQUFNLENBQ0osR0FBK0IsRUFDL0IsTUFBc0MsRUFDdEMsVUFBbUIsRUFDWDtRQUNSLE1BQU0sS0FBSyxHQUFHLFVBQVUsR0FBRyxNQUFNLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQyxNQUFNLElBQUksQ0FBQyxBQUFDO1FBQzlELE1BQU0sT0FBTyxHQUFhLElBQUksS0FBSyxDQUFDLEtBQUssQ0FBQyxBQUFDO1FBRTNDLElBQUksQ0FBQyxVQUFVLEVBQUU7WUFDZixJQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsS0FBSyxFQUFFLENBQUMsRUFBRSxDQUFFO2dCQUM5QixNQUFNLEtBQUssR0FBRyxNQUFNLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxBQUFDO2dCQUU1QixJQUFJLE1BQU0sQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLEVBQUU7b0JBQzFCLE9BQU8sQ0FBQyxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUM7aUJBQ3BCO2dCQUVELGVBQWU7Z0JBQ2YsTUFBTSxRQUFRLEdBQVcsTUFBTSxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEFBQVUsQUFBQztnQkFDckQsT0FBTyxDQUFDLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFZLFFBQVEsQ0FBQyxDQUFDO2FBQ3JEO1NBQ0YsTUFBTTtZQUNMLElBQUssSUFBSSxFQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUMsR0FBRyxLQUFLLEVBQUUsRUFBQyxFQUFFLENBQUU7Z0JBQzlCLE9BQU8sQ0FBQyxFQUFDLENBQUMsR0FBRyxNQUFNLENBQUMsRUFBQyxDQUFDLEFBQVUsQ0FBQzthQUNsQztTQUNGO1FBRUQsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsRUFBRSxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7S0FDdEQ7SUFFRDs7O0tBR0csQ0FDSCxnQkFBZ0IsQ0FBQyxHQUErQixFQUFFLElBQVksRUFBVTtRQUN0RSxNQUFNLE1BQU0sR0FBRyxJQUFJLFdBQVcsRUFBRSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQUFBQztRQUU5QyxPQUFPLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0tBQ3RDO0lBRUQ7OztLQUdHLENBQ0gsZUFBZSxDQUFDLEdBQStCLEVBQUUsSUFBWSxFQUFVO1FBQ3JFLE1BQU0sTUFBTSxHQUFHLElBQUksV0FBVyxFQUFFLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxBQUFDO1FBRTlDLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLEVBQUUsTUFBTSxDQUFDLENBQUM7S0FDdEM7SUFFRDs7O0tBR0csQ0FDSCxlQUFlLENBQUMsSUFBZ0MsRUFBRSxLQUFhLEVBQVU7UUFDdkUsY0FBYyxDQUFDLDJDQUEyQyxDQUFDLENBQUM7S0FDN0Q7SUFFRDs7O0tBR0csQ0FDSCxpQkFBaUIsQ0FBQyxHQUErQixFQUFFLElBQVksRUFBVTtRQUN2RSxNQUFNLE1BQU0sR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxRQUFRLENBQUMsQUFBQztRQUMzQyxPQUFPLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0tBQ3RDO0lBRUQsQUFBUyxRQUFRLEdBQVc7UUFDMUIsSUFBSSxNQUFNLEdBQUcsQ0FBQyxBQUFDO1FBQ2YsSUFBSSxDQUFDLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQztRQUV0QixJQUFJO1lBQ0YsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUM7U0FDakMsQ0FBQyxPQUFNO1lBQ04sTUFBTSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLEFBQUMsQ0FBQztTQUNuQztRQUVELE9BQU8sTUFBTSxDQUFDO0tBQ2Y7SUFFRDs7O0tBR0csQ0FDSCxDQUFBLENBQUMsY0FBYyxDQUFDLE1BQWdELEVBQVE7UUFDdEUsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEdBQUcsTUFBTSxDQUFDO0tBQ2pDO0lBRUQsNERBQTRELENBQzVELE1BQU0sQ0FBQyxJQUFJLEdBQWtCO1FBQzNCLElBQUksR0FBRyxHQUFHLElBQUksVUFBVSxDQUFDLGNBQWMsQ0FBQyxBQUFDO1FBRXpDLElBQUksS0FBSyxBQUFlLEFBQUM7UUFDekIsSUFBSTtZQUNGLEtBQUssR0FBRyxNQUFNLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztTQUNqRCxDQUFDLE9BQU8sQ0FBQyxFQUFFO1lBQ1YsSUFDRSxDQUFDLFlBQVksSUFBSSxDQUFDLE1BQU0sQ0FBQyxXQUFXLElBQ3BDLENBQUMsWUFBWSxJQUFJLENBQUMsTUFBTSxDQUFDLFdBQVcsRUFDcEM7Z0JBQ0EsS0FBSyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLEFBQUMsQ0FBQzthQUM3QixNQUFNLElBQ0wsQ0FBQyxZQUFZLElBQUksQ0FBQyxNQUFNLENBQUMsZUFBZSxJQUN4QyxDQUFDLFlBQVksSUFBSSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsRUFDMUM7Z0JBQ0EsS0FBSyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLEFBQUMsQ0FBQzthQUNwQyxNQUFNO2dCQUNMLEtBQUssR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxBQUFDLENBQUM7YUFDakM7WUFFRCxHQUFHLEdBQUcsSUFBSSxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDekI7UUFFRCxLQUFLLEtBQUssT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQUFBQyxDQUFDO1FBRTlCLGVBQWUsQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLEtBQUssQ0FBQztRQUUzQyxJQUFJLEtBQUssR0FBRyxDQUFDLEVBQUU7WUFDYixJQUFJLENBQUMsU0FBUyxJQUFJLEtBQUssQ0FBQztTQUN6QjtRQUVELEdBQUcsR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUUxQixlQUFlLENBQUMsa0JBQWtCLENBQUMsR0FBRyxDQUFDLENBQUM7UUFFeEMsSUFBSTtZQUNGLElBQUksQ0FBQyxNQUFNLENBQUUsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFDO1NBQzFCLENBQUMsT0FBTTtRQUNOLDJCQUEyQjtTQUM1QjtRQUVELElBQUksS0FBSyxJQUFJLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQyxPQUFPLEVBQUU7WUFDL0IsSUFBSSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7U0FDZDtLQUNGO0lBRUQ7Ozs7S0FJRyxDQUNILE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBK0IsRUFBRSxJQUFnQixFQUFFO1FBQzlELE1BQU0sRUFBRSxVQUFVLENBQUEsRUFBRSxHQUFHLElBQUksQUFBQztRQUU1QixJQUFJO1lBQ0YsTUFBTSxRQUFRLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEVBQUcsSUFBSSxDQUFDLENBQUM7U0FDL0MsQ0FBQyxPQUFPLEVBQUMsRUFBRTtZQUNWLElBQUksTUFBTSxBQUFRLEFBQUM7WUFFbkIseUNBQXlDO1lBQ3pDLElBQ0UsRUFBQyxZQUFZLElBQUksQ0FBQyxNQUFNLENBQUMsV0FBVyxJQUNwQyxFQUFDLFlBQVksSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLEVBQ25DO2dCQUNBLE1BQU0sR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxBQUFDLENBQUM7YUFDaEMsTUFBTTtnQkFDTCxNQUFNLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQUFBQyxDQUFDO2FBQ2xDO1lBRUQsSUFBSTtnQkFDRixHQUFHLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDO2FBQ3hCLENBQUMsT0FBTTtZQUNOLDJCQUEyQjthQUM1QjtZQUVELE9BQU87U0FDUjtRQUVELGVBQWUsQ0FBQyxhQUFhLENBQUMsR0FBRyxVQUFVLENBQUM7UUFDNUMsSUFBSSxDQUFDLFlBQVksSUFBSSxVQUFVLENBQUM7UUFFaEMsSUFBSTtZQUNGLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDbkIsQ0FBQyxPQUFNO1FBQ04sMkJBQTJCO1NBQzVCO1FBRUQsT0FBTztLQUNSO0NBQ0YifQ==